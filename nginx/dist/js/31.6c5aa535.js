"use strict";(self["webpackChunkfrontend_web"]=self["webpackChunkfrontend_web"]||[]).push([[31],{21031:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});a(70560);var n=a(73396),l=a(87139);const s=e=>((0,n.dD)("data-v-97481074"),e=e(),(0,n.Cn)(),e),i={class:"data_box"},o=s((()=>(0,n._)("span",{class:"el-icon-collection-tag"},null,-1))),c=s((()=>(0,n._)("b",null,"基本信息",-1))),d=s((()=>(0,n._)("b",null,"测试场景",-1))),r={class:"el-icon-s-help",style:{color:"#409eff","font-weight":"bold","font-size":"14px","margin-right":"5px"}},p={style:{"font-weight":"bold","font-size":"14px"}},u=s((()=>(0,n._)("b",null,"通过率趋势图",-1))),m={ref:"chartTable",class:"char_box1"},h=s((()=>(0,n._)("b",null,"近三天执行记录",-1))),w={key:0},f={key:0},g={key:0},_={key:0},y=s((()=>(0,n._)("b",{style:{color:"#000000"}},"添加测试场景",-1))),k={class:"select_content",style:{position:"relative",height:"calc(100vh - 130px)","overflow-y":"auto"}},W={style:{margin:"10px","text-align":"center"}};function b(e,t,a,s,b,v){const P=(0,n.up)("el-tab-pane"),x=(0,n.up)("el-tabs"),z=(0,n.up)("el-button"),$=(0,n.up)("el-menu-item"),C=(0,n.up)("el-menu"),I=(0,n.up)("el-scrollbar"),S=(0,n.up)("el-col"),T=(0,n.up)("el-divider"),D=(0,n.up)("el-input"),U=(0,n.up)("el-row"),L=(0,n.up)("el-table-column"),A=(0,n.up)("el-table"),R=(0,n.up)("el-tag"),V=(0,n.up)("el-tooltip"),j=(0,n.up)("el-drawer");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(U,{gutter:10},{default:(0,n.w5)((()=>[(0,n.Wm)(S,{span:4},{default:(0,n.w5)((()=>[(0,n._)("div",i,[(0,n.Wm)(x,{type:"border-card",stretch:""},{default:(0,n.w5)((()=>[(0,n.Wm)(P,{label:"测试计划"})])),_:1}),(0,n.Wm)(z,{onClick:v.addPlan,type:"success",plain:"",size:"mini",style:{width:"100%"},icon:"el-icon-plus"},{default:(0,n.w5)((()=>[(0,n.Uk)("添加测试计划")])),_:1},8,["onClick"]),(0,n.Wm)(I,{height:"calc(100vh - 134px);"},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{"default-active":b.active,class:"el-menu-vertical-demo","active-text-color":"#409eff","text-color":"#000000",style:{background:"none",border:"none"}},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(b.planList,(e=>((0,n.wg)(),(0,n.j4)($,{onClick:t=>v.getPlanData(e),index:e.id.toString(),style:{height:"35px","line-height":"35px"}},{default:(0,n.w5)((()=>[o,(0,n._)("span",null,(0,l.zw)(e.name),1)])),_:2},1032,["onClick","index"])))),256))])),_:1},8,["default-active"])])),_:1})])])),_:1}),b.planInfo?((0,n.wg)(),(0,n.j4)(S,{key:0,span:10},{default:(0,n.w5)((()=>[(0,n.Wm)(T,{"content-position":"left"},{default:(0,n.w5)((()=>[c])),_:1}),(0,n.Wm)(U,{gutter:5,style:{"margin-bottom":"20px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(S,{span:16},{default:(0,n.w5)((()=>[(0,n.Wm)(D,{modelValue:b.planInfo.name,"onUpdate:modelValue":t[0]||(t[0]=e=>b.planInfo.name=e),size:"mini"},{prepend:(0,n.w5)((()=>[(0,n.Uk)(" 计划名称 ")])),append:(0,n.w5)((()=>[(0,n.Wm)(z,{onClick:v.savePlan,plain:"",icon:"el-icon-circle-check",size:"mini",type:"primary"},{default:(0,n.w5)((()=>[(0,n.Uk)("保存")])),_:1},8,["onClick"])])),_:1},8,["modelValue"])])),_:1}),(0,n.Wm)(S,{span:8,style:{"text-align":"right"}},{default:(0,n.w5)((()=>[(0,n.Wm)(z,{onClick:v.runPlan,size:"mini",type:"primary",icon:"el-icon-s-promotion"},{default:(0,n.w5)((()=>[(0,n.Uk)("运行")])),_:1},8,["onClick"]),(0,n.Wm)(z,{onClick:v.delPlan,plain:"",icon:"el-icon-delete",size:"mini",type:"danger"},{default:(0,n.w5)((()=>[(0,n.Uk)("删除")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,n.Wm)(T,{"content-position":"left"},{default:(0,n.w5)((()=>[d])),_:1}),(0,n.Wm)(I,{height:"calc(100vh - 210px)"},{default:(0,n.w5)((()=>[(0,n.Wm)(A,{data:b.scents,"row-key":"id",style:{width:"100%","margin-bottom":"10px"},"show-header":!1,"empty-text":"暂无数据"},{default:(0,n.w5)((()=>[(0,n.Wm)(L,null,{default:(0,n.w5)((e=>[(0,n._)("span",r,(0,l.zw)("测试场景"+(e.$index+1)),1),(0,n._)("span",p,(0,l.zw)(e.row.name),1)])),_:1}),(0,n.Wm)(L,{width:"100px"},{default:(0,n.w5)((e=>[(0,n.Wm)(z,{onClick:v.delPlanInScent,plain:"",size:"mini",type:"danger",icon:"el-icon-delete"},{default:(0,n.w5)((()=>[(0,n.Uk)("删除")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["data"]),(0,n.Wm)(z,{onClick:t[1]||(t[1]=e=>b.drawer=!0),plain:"",icon:"el-icon-plus",size:"mini",type:"success"},{default:(0,n.w5)((()=>[(0,n.Uk)("添加测试场景")])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(S,{span:10},{default:(0,n.w5)((()=>[(0,n.Wm)(T,{"content-position":"left"},{default:(0,n.w5)((()=>[u])),_:1}),(0,n._)("div",m,null,512),(0,n.Wm)(T,{"content-position":"left"},{default:(0,n.w5)((()=>[h])),_:1}),(0,n.Wm)(I,{height:"calc(100vh - 380px)"},{default:(0,n.w5)((()=>[(0,n.Wm)(A,{data:b.records,class:"table-style",size:"mini","empty-text":"暂无数据"},{default:(0,n.w5)((()=>[(0,n.Wm)(L,{prop:"create_time",label:"执行时间","min-width":"140",align:"center"},{default:(0,n.w5)((t=>[(0,n.Uk)((0,l.zw)(e.$tools.rTime(t.row.create_time)),1)])),_:1}),(0,n.Wm)(L,{prop:"env_name",label:"测试环境","min-width":"110",align:"center"}),(0,n.Wm)(L,{prop:"all",label:"总用例","min-width":"50",align:"center"},{default:(0,n.w5)((e=>["执行中"!==e.row.statue?((0,n.wg)(),(0,n.iD)("span",w,(0,l.zw)(e.row.all),1)):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(L,{label:"通过数","min-width":"50",align:"center"},{default:(0,n.w5)((e=>["执行中"!==e.row.statue?((0,n.wg)(),(0,n.iD)("span",f,(0,l.zw)(e.row.success),1)):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(L,{label:"通过率","min-width":"80",align:"center"},{default:(0,n.w5)((e=>["执行中"!==e.row.statue?((0,n.wg)(),(0,n.iD)("span",g,(0,l.zw)(e.row.pass_rate+"%"),1)):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(L,{label:"测试报告",width:"100",align:"center"},{default:(0,n.w5)((t=>["执行中"===t.row.status?((0,n.wg)(),(0,n.iD)("span",_,[(0,n.Wm)(R,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(t.row.status),1)])),_:2},1024)])):((0,n.wg)(),(0,n.j4)(z,{key:1,type:"success",icon:"el-icon-view",plain:"",size:"mini",onClick:a=>e.$router.push({name:"report",params:{id:t.row.id}})},{default:(0,n.w5)((()=>[(0,n.Uk)(" 报告 ")])),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data"])])),_:1})])),_:1})])),_:1}),(0,n.Wm)(j,{modelValue:b.drawer,"onUpdate:modelValue":t[4]||(t[4]=e=>b.drawer=e),direction:"rtl",size:"30%","show-close":!1},{title:(0,n.w5)((()=>[y])),default:(0,n.w5)((()=>[(0,n._)("div",k,[(0,n.Wm)(A,{ref:"addRef",onSelectionChange:v.selectTable,size:"mini",data:v.Scents2,"tooltip-effect":"dark",style:{width:"100%"},"empty-text":"暂无数据"},{default:(0,n.w5)((()=>[(0,n.Wm)(L,{type:"selection","min-width":"40"}),(0,n.Wm)(L,{prop:"name",label:"全选","min-width":"120"})])),_:1},8,["onSelectionChange","data"])]),(0,n._)("div",W,[(0,n.Wm)(V,{class:"item",effect:"dark",content:"添加选中测试流程到任务中",placement:"top-start"},{default:(0,n.w5)((()=>[(0,n.Wm)(z,{onClick:v.addScentToPlan,plain:"",type:"success",size:"mini"},{default:(0,n.w5)((()=>[(0,n.Uk)("确认添加")])),_:1},8,["onClick"])])),_:1}),(0,n.Wm)(V,{class:"item",effect:"dark",content:"清除选中选项",placement:"top-start"},{default:(0,n.w5)((()=>[(0,n.Wm)(z,{plain:"",type:"warning",size:"mini",onClick:t[2]||(t[2]=t=>e.$refs.addRef.clearSelection())},{default:(0,n.w5)((()=>[(0,n.Uk)("清除选中")])),_:1})])),_:1}),(0,n.Wm)(V,{class:"item",effect:"dark",content:"关闭当前窗口",placement:"top-start"},{default:(0,n.w5)((()=>[(0,n.Wm)(z,{plain:"",type:"danger",size:"mini",onClick:t[3]||(t[3]=e=>b.drawer=!1)},{default:(0,n.w5)((()=>[(0,n.Uk)("关闭窗口")])),_:1})])),_:1})])])),_:1},8,["modelValue"])],64)}var v=a(20065),P=a(37046),x={components:{},data(){return{planList:[],planInfo:null,active:"1",scents:[],records:[],drawer:!1,addScentList:[]}},computed:{...(0,v.rn)(["pro","envId","testScents"]),chartData:function(){let e=[],t=[];for(let a of this.records)e.push(this.$tools.rTime(a.create_time)),t.push(parseFloat(a.pass_rate).toFixed(2));return{label:e.reverse(),value:t}},Scents2:function(){let e=this.testScents.filter(((e,t)=>!this.scents.find((t=>t.id==e.id))));return e}},methods:{async getAllPlan(){const e=await this.$api.getTestPlan(this.pro.id);200===e.status&&(this.planList=e.data,this.planList.length>0&&null==this.planInfo&&(this.active=this.planList[0].id.toString(),this.getPlanData(this.planList[0])))},async getPlanData(e){this.planInfo={...e};const t=await this.$api.getTestScent({testplan:e.id});200==t.status&&(this.scents=t.data),this.getAllRecord()},async getAllRecord(){const e=await this.$api.getTestRecord({plan:this.planInfo.id,project:this.pro.id});200==e.status&&(this.records=e.data)},async addPlan(){const e={project:this.pro.id,name:"New Plan"},t=await this.$api.createTestPlan(e);201===t.status&&(this.$message({type:"success",message:"添加成功",duration:1e3}),this.getAllPlan())},async savePlan(){const e=await this.$api.updateTestPlan(this.planInfo.id,this.planInfo);200===e.status&&(this.$message({type:"success",message:"保存成功",duration:1e3}),this.getAllPlan())},async runPlan(){if(this.envId){const e={env:this.envId,plan:this.planInfo.id,types:1};this.$message({type:"success",message:"开始运行!",duration:1e3});const t=await this.$api.runPlan(this.planInfo.id,e);200===t.status&&((0,P.bM)({title:"提示",message:t.data.status,duration:1e3}),this.getAllRecord()),console.log(t.data)}else this.$message({type:"warning",message:"当前未选中执行环境!",duration:1e3})},delPlan(){P.T$.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await this.$api.delTestPlan(this.planInfo.id);204===e.status&&((0,P.z8)({type:"success",message:"删除成功",duration:1e3}),this.getAllPlan())})).catch((()=>{(0,P.z8)({type:"info",message:"取消删除",duration:1e3})}))},selectTable(e){e.forEach((e=>{this.addScentList.push(e.id)}))},async addScentToPlan(){if(0===this.addScentList.length)return void this.$message({type:"warning",message:"请勾选要添加的测试场景",duration:1e3});let e={...this.planInfo};e.scenes.push(...this.addScentList);const t=await this.$api.updateTestPlan(e.id,e);200===t.status&&(this.$message({type:"success",message:"添加成功",duration:1e3}),this.planInfo=t.data,this.getPlanData(this.planInfo)),this.$refs.addRef.clearSelection(),this.drawer=!1},async delPlanInScent(e){let t={...this.planInfo};t.scenes.splice(e,1);const a=await this.$api.updateTestPlan(t.id,t);200===a.status&&(this.$message({type:"success",message:"删除成功",duration:1e3}),this.planInfo=a.data,this.getPlanData(this.planInfo))}},created(){this.getAllPlan()},watch:{records(){this.$chart.chart3(this.$refs.chartTable,this.chartData.value,this.chartData.label)}}},z=a(40089);const $=(0,z.Z)(x,[["render",b],["__scopeId","data-v-97481074"]]);var C=$}}]);
//# sourceMappingURL=31.6c5aa535.js.map