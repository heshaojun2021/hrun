"use strict";(self["webpackChunkfrontend_web"]=self["webpackChunkfrontend_web"]||[]).push([[378],{41694:function(e,t,l){l.r(t),l.d(t,{default:function(){return xt}});var a=l(73396),o=l(87139),s=l(49242);const n=e=>((0,a.dD)("data-v-d021862e"),e=e(),(0,a.Cn)(),e),i={slot:"header"},r={style:{display:"flex","justify-content":"space-between","align-items":"center",height:"2px"}},d={style:{"margin-right":"15px"}},c={style:{"margin-left":"15px","font-weight":"bold"}},p=n((()=>(0,a._)("i",{class:"el-icon-arrow-down el-icon--right"},null,-1))),u=n((()=>(0,a._)("i",{class:"el-icon-connection",style:{"margin-right":"-1px"}},null,-1))),m=n((()=>(0,a._)("i",{class:"el-icon-share",style:{"margin-right":"-1px"}},null,-1))),f=n((()=>(0,a._)("i",{class:"el-icon-refresh",style:{"margin-right":"-1px"}},null,-1))),h=n((()=>(0,a._)("i",{class:"el-icon-reading",style:{"margin-right":"-1px"}},null,-1))),g=n((()=>(0,a._)("i",{class:"el-icon-coin",style:{"margin-right":"-1px"}},null,-1))),w=n((()=>(0,a._)("i",{class:"el-icon-timer",style:{"margin-right":"-1px"}},null,-1))),y={class:"tree-component"},_={style:{color:"#00aaff","font-weight":"bold"}},k={style:{"padding-top":"15px","margin-left":"20px"}},C={slot:"header"},b={class:"style"},I={key:0},v={slot:"header",class:"card-title"},x={style:{"font-weight":"bold","margin-top":"-9px"}},W={class:"icon",style:{color:"rgb(97, 100, 159)","background-color":"#e9eef3"}},D=n((()=>(0,a._)("i",{class:"el-icon-connection",style:{color:"#61649f","margin-right":"20px"}},null,-1))),U={key:0},V={key:1},z={key:2},S={key:3},T={key:4},E={key:5},q={class:"card-url"},$={class:"card-name"},R={key:1},A={slot:"header",class:"card-title"},F={style:{"margin-top":"-9px"}},j={class:"icon",style:{color:"rgb(230, 162, 60)","background-color":"rgb(252, 246, 238)"}},M=n((()=>(0,a._)("i",{class:"el-icon-share",style:{color:"rgb(230, 162, 60)","margin-right":"20px"}},null,-1))),N=["onUpdate:modelValue"],O=["onUpdate:modelValue"],B=["onUpdate:modelValue"],P={key:2},L={slot:"header",class:"card-title"},H={style:{"margin-top":"-12px"}},K={class:"icon",style:{color:"rgb(2, 167, 240)","background-color":"rgb(244, 244, 245)"}},Z=n((()=>(0,a._)("i",{class:"el-icon-refresh",style:{color:"rgb(2, 167, 240)","margin-right":"20px"}},null,-1))),Y={key:0},G={class:"loop"},J=n((()=>(0,a._)("span",{style:{"padding-right":"5px"}},"循环次数",-1))),Q=n((()=>(0,a._)("span",{style:{"padding-right":"5px","padding-left":"10px"}},"循环间隔",-1))),X={key:1},ee={class:"loop"},te=n((()=>(0,a._)("b",{style:{"margin-left":"10px","margin-right":"10px"}},"in",-1))),le=n((()=>(0,a._)("span",{style:{"padding-right":"5px","padding-left":"10px"}},"循环间隔",-1))),ae={key:2},oe=n((()=>(0,a._)("div",{class:"loop"},"敬请期待！",-1))),se=[oe],ne={key:3},ie={slot:"header",class:"card-title"},re={style:{"margin-top":"-9px"}},de={class:"icon",style:{color:"rgb(123, 77, 18)","background-color":"rgb(244, 244, 245)"}},ce=n((()=>(0,a._)("i",{class:"el-icon-reading",style:{color:"rgb(123, 77, 18)","margin-right":"20px"}},null,-1))),pe=n((()=>(0,a._)("i",{class:"el-icon-edit"},null,-1))),ue={class:"code_mod"},me={class:"code_mod"},fe={class:"code_mod"},he={class:"code_mod"},ge={key:4},we={slot:"header",class:"card-title"},ye={style:{"margin-top":"-9px"}},_e={class:"icon",style:{color:"rgb(120, 56, 135)","background-color":"rgb(242, 236, 243)"}},ke=n((()=>(0,a._)("i",{class:"el-icon-coin",style:{color:"rgb(120, 56, 135)","margin-right":"20px"}},null,-1))),Ce=n((()=>(0,a._)("i",{class:"el-icon-edit"},null,-1))),be={style:{"margin-left":"50%","margin-top":"30px"}},Ie=n((()=>(0,a._)("i",null,"该功能敬请期待噢！",-1))),ve=[Ie],xe={key:5},We={slot:"header",class:"card-title"},De={style:{"margin-top":"-9px"}},Ue={class:"icon",style:{color:"rgb(103, 194, 58)","background-color":"rgb(242, 249, 238)"}},Ve=n((()=>(0,a._)("i",{class:"el-icon-timer",style:{color:"rgb(103, 194, 58)","margin-right":"20px"}},null,-1))),ze=n((()=>(0,a._)("span",{style:{"margin-left":"10px"}},"s",-1))),Se={class:"card-content"},Te={style:{padding:"20px"}},Ee={style:{color:"#00aaff"}},qe={style:{color:"#00aa7f"}},$e={style:{color:"orangered"}},Re={style:{color:"#fca130"}},Ae=n((()=>(0,a._)("div",{style:{height:"40px","line-height":"40px"}},[(0,a._)("b",null,"执行详情")],-1))),Fe={key:0},je={key:0},Me={key:0,style:{color:"#00AA7F"}},Ne={key:1,style:{color:"#F56C6C"}},Oe={key:2,style:{color:"#fca130"}};function Be(e,t,l,n,oe,Ie){const Be=(0,a.up)("el-button"),Pe=(0,a.up)("el-dropdown-item"),Le=(0,a.up)("el-dropdown-menu"),He=(0,a.up)("el-dropdown"),Ke=(0,a.up)("el-card"),Ze=(0,a.up)("el-input"),Ye=(0,a.up)("el-form-item"),Ge=(0,a.up)("el-form"),Je=(0,a.up)("el-col"),Qe=(0,a.up)("el-tag"),Xe=(0,a.up)("el-option"),et=(0,a.up)("el-select"),tt=(0,a.up)("ArrowDown"),lt=(0,a.up)("el-icon"),at=(0,a.up)("ArrowRight"),ot=(0,a.up)("el-radio"),st=(0,a.up)("el-radio-group"),nt=(0,a.up)("el-input-number"),it=(0,a.up)("Editor"),rt=(0,a.up)("el-divider"),dt=(0,a.up)("el-row"),ct=(0,a.up)("el-switch"),pt=(0,a.up)("el-tree"),ut=(0,a.up)("el-scrollbar"),mt=(0,a.up)("apiCite"),ft=(0,a.up)("newEditCase"),ht=(0,a.up)("el-drawer"),gt=(0,a.up)("el-descriptions-item"),wt=(0,a.up)("el-descriptions"),yt=(0,a.up)("caseResult"),_t=(0,a.up)("el-table-column"),kt=(0,a.up)("el-table");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(Ke,null,{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a._)("div",r,[(0,a._)("div",d,[(0,a.Wm)(Be,{size:"large",type:"text",icon:"el-icon-caret-left",onClick:Ie.goBack},{default:(0,a.w5)((()=>[(0,a.Uk)("返回")])),_:1},8,["onClick"]),(0,a._)("span",c,(0,o.zw)(null!==this.case?"编辑用例":"新增用例"),1)]),(0,a._)("div",null,[(0,a.Wm)(He,{style:{"margin-right":"10px"},trigger:"click"},{dropdown:(0,a.w5)((()=>[(0,a.Wm)(Le,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Pe,{command:"api",style:{color:"#61649f"},onClick:Ie.showApiCite},{default:(0,a.w5)((()=>[u,(0,a.Uk)(" 引用接口 ")])),_:1},8,["onClick"]),(0,a.Wm)(Pe,{command:"condition",style:{color:"#E6A23C"},onClick:t[0]||(t[0]=e=>Ie.AddController("if"))},{default:(0,a.w5)((()=>[m,(0,a.Uk)(" 条件控制器 ")])),_:1}),(0,a.Wm)(Pe,{command:"cyclic",style:{color:"#02A7F0FF"},onClick:t[1]||(t[1]=e=>Ie.AddController("for"))},{default:(0,a.w5)((()=>[f,(0,a.Uk)(" 循环控制器 ")])),_:1}),(0,a.Wm)(Pe,{command:"script",style:{color:"#7B4D12FF"},onClick:t[2]||(t[2]=e=>Ie.AddController("script"))},{default:(0,a.w5)((()=>[h,(0,a.Uk)(" 自定义脚本 ")])),_:1}),(0,a.Wm)(Pe,{command:"sql",style:{color:"#783887FF"},onClick:t[3]||(t[3]=e=>Ie.AddController("sql"))},{default:(0,a.w5)((()=>[g,(0,a.Uk)(" SQL控制器 ")])),_:1}),(0,a.Wm)(Pe,{command:"time",style:{color:"#67C23AFF"},onClick:t[4]||(t[4]=e=>Ie.AddController("time"))},{default:(0,a.w5)((()=>[w,(0,a.Uk)(" 等待控制器 ")])),_:1})])),_:1})])),default:(0,a.w5)((()=>[(0,a.Wm)(Be,{type:"warning",round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("添加步骤 "),p])),_:1})])),_:1}),(0,a.Wm)(Be,{icon:"el-icon-bug",type:"success",onClick:Ie.runCase,round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("调试")])),_:1},8,["onClick"]),this.case?((0,a.wg)(),(0,a.j4)(Be,{key:0,type:"primary",onClick:Ie.editCaseSave,round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("保存")])),_:1},8,["onClick"])):((0,a.wg)(),(0,a.j4)(Be,{key:1,type:"primary",onClick:Ie.addCaseSave,round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("保存")])),_:1},8,["onClick"]))])])])])),_:1}),(0,a.Wm)(dt,{gutter:10},{default:(0,a.w5)((()=>[(0,a.Wm)(Je,{span:6},{default:(0,a.w5)((()=>[(0,a._)("div",y,[(0,a.Wm)(Ge,{model:oe.editForm,rules:oe.rulesCase,ref:"CaseRef","label-width":"80px",style:{"max-width":"500px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(Ye,{label:"用例名称",prop:"name",size:"mini"},{default:(0,a.w5)((()=>[(0,a.Wm)(Ze,{modelValue:oe.editForm.name,"onUpdate:modelValue":t[5]||(t[5]=e=>oe.editForm.name=e),placeholder:"请输入用例名称"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(Ye,{prop:"project_id",label:"所属项目",size:"mini"},{default:(0,a.w5)((()=>[(0,a.Wm)(Ze,{modelValue:oe.editForm.project_id,"onUpdate:modelValue":t[6]||(t[6]=e=>oe.editForm.project_id=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(Ye,{label:"用例描述",prop:"desc"},{default:(0,a.w5)((()=>[(0,a.Wm)(Ze,{type:"textarea",modelValue:oe.editForm.desc,"onUpdate:modelValue":t[7]||(t[7]=e=>oe.editForm.desc=e),placeholder:"请输入备注"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(Ye,{label:"步骤总数：","label-width":"93px"},{default:(0,a.w5)((()=>[(0,a._)("div",_,(0,o.zw)(oe.editForm.stepCount),1)])),_:1})])),_:1},8,["model","rules"])])])),_:1}),(0,a.Wm)(Je,{span:18},{default:(0,a.w5)((()=>[(0,a.Wm)(ut,{height:"calc(100vh - 100px)"},{default:(0,a.w5)((()=>[(0,a._)("div",k,[(0,a.Wm)(pt,{data:oe.steps,props:Ie.defaultProps,draggable:"","default-expand-all":!1,"expand-on-click-node":!1,onNodeClick:Ie.handleStepClick,"allow-drop":Ie.allowDrop,onNodeDrop:Ie.updateStepOrder,"node-drag-start":Ie.handleDragScroll},{default:(0,a.w5)((({node:e,data:l})=>[l.stepInfo?((0,a.wg)(),(0,a.j4)(Ke,{key:0,style:(0,o.j5)(Ie.getRowClassName(l.stepInfo.type))},{default:(0,a.w5)((()=>[(0,a._)("div",C,[(0,a.Wm)(Je,{span:20},{default:(0,a.w5)((()=>[(0,a._)("div",b,["api"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",I,[(0,a._)("span",v,[(0,a._)("div",x,[(0,a._)("span",W,(0,o.zw)(Ie.getCardIndex(e.parent,e)),1),D,"POST"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",U,[(0,a.Wm)(Qe,{color:"#49cc90",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"GET"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",V,[(0,a.Wm)(Qe,{color:"#61affe",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"PUT"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",z,[(0,a.Wm)(Qe,{color:"#fca130",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"PATCH"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",S,[(0,a.Wm)(Qe,{color:"#50e3c2",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"DELETE"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",T,[(0,a.Wm)(Qe,{color:"#f93e3e",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"DEAD"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",E,[(0,a.Wm)(Qe,{color:"rgb(201, 233, 104)",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.method),1)])),_:2},1024)])):(0,a.kq)("",!0)]),(0,a._)("b",q,(0,o.zw)(l.stepInfo.url),1),(0,a._)("span",$,(0,o.zw)(l.stepInfo.name),1)])])):(0,a.kq)("",!0),"if"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",R,[(0,a._)("span",A,[(0,a._)("div",F,[(0,a._)("span",j,(0,o.zw)(Ie.getCardIndex(e.parent,e)),1),M,(0,a._)("span",null,[(0,a.wy)((0,a._)("input",{class:"input-def",placeholder:"变量，例如{{name}}","onUpdate:modelValue":e=>l.stepInfo.content.variable=e},null,8,N),[[s.nr,l.stepInfo.content.variable]]),(0,a.Wm)(et,{modelValue:l.stepInfo.content.JudgmentMode,"onUpdate:modelValue":e=>l.stepInfo.content.JudgmentMode=e,placeholder:"请选择",size:"small",style:{"margin-right":"8px",width:"100px"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(oe.options,(e=>((0,a.wg)(),(0,a.j4)(Xe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,a.wy)((0,a._)("input",{class:"input-def",placeholder:"值","onUpdate:modelValue":e=>l.stepInfo.content.value=e},null,8,O),[[s.nr,l.stepInfo.content.value]]),(0,a.wy)((0,a._)("input",{class:"input-def",placeholder:"备注","onUpdate:modelValue":e=>l.stepInfo.desc=e},null,8,B),[[s.nr,l.stepInfo.desc]])])])])])):(0,a.kq)("",!0),"for"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",P,[(0,a._)("span",L,[(0,a._)("div",H,[(0,a._)("span",K,(0,o.zw)(Ie.getCardIndex(e.parent,e)),1),Z,(0,a.Wm)(Be,{onClick:e=>Ie.toggleExpand(l.stepInfo),type:"text",style:{"margin-right":"10px"}},{default:(0,a.w5)((()=>[l.stepInfo.dlg?((0,a.wg)(),(0,a.j4)(lt,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(tt)])),_:1})):((0,a.wg)(),(0,a.j4)(lt,{key:1},{default:(0,a.w5)((()=>[(0,a.Wm)(at)])),_:1}))])),_:2},1032,["onClick"]),(0,a.Wm)(st,{modelValue:l.stepInfo.content.select,"onUpdate:modelValue":e=>l.stepInfo.content.select=e},{default:(0,a.w5)((()=>[(0,a.Wm)(ot,{label:"count",value:"count"},{default:(0,a.w5)((()=>[(0,a.Uk)("次数循环")])),_:1}),(0,a.Wm)(ot,{label:"for",value:"for"},{default:(0,a.w5)((()=>[(0,a.Uk)("for循环")])),_:1}),(0,a.Wm)(ot,{label:"while",value:"while",disabled:""},{default:(0,a.w5)((()=>[(0,a.Uk)("while循环")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])]),l.stepInfo.dlg?((0,a.wg)(),(0,a.iD)("div",{key:l.id},["count"===l.stepInfo.content.select||""===l.stepInfo.content.select?((0,a.wg)(),(0,a.iD)("div",Y,[(0,a._)("div",G,[J,(0,a.Wm)(Ze,{modelValue:l.stepInfo.content.cycleIndex,"onUpdate:modelValue":e=>l.stepInfo.content.cycleIndex=e,style:{width:"200px"},placeholder:"循环次数"},null,8,["modelValue","onUpdate:modelValue"]),Q,(0,a.Wm)(nt,{modelValue:l.stepInfo.content.cycleInterval,"onUpdate:modelValue":e=>l.stepInfo.content.cycleInterval=e,min:0,max:999,size:"small","controls-position":"right",placeholder:"秒"},null,8,["modelValue","onUpdate:modelValue"])])])):(0,a.kq)("",!0),"for"===l.stepInfo.content.select?((0,a.wg)(),(0,a.iD)("div",X,[(0,a._)("div",ee,[(0,a.Wm)(Ze,{style:{width:"200px"},placeholder:"定义变量名称",modelValue:l.stepInfo.content.variableName,"onUpdate:modelValue":e=>l.stepInfo.content.variableName=e},null,8,["modelValue","onUpdate:modelValue"]),te,(0,a.Wm)(Ze,{style:{width:"200px"},placeholder:"变量，例如{{name}}",modelValue:l.stepInfo.content.variable,"onUpdate:modelValue":e=>l.stepInfo.content.variable=e},null,8,["modelValue","onUpdate:modelValue"]),le,(0,a.Wm)(nt,{modelValue:l.stepInfo.content.cycleInterval,"onUpdate:modelValue":e=>l.stepInfo.content.cycleInterval=e,min:0,max:999,size:"small","controls-position":"right",placeholder:"秒"},null,8,["modelValue","onUpdate:modelValue"])])])):(0,a.kq)("",!0),"while"===l.stepInfo.content.select?((0,a.wg)(),(0,a.iD)("div",ae,se)):(0,a.kq)("",!0)])):(0,a.kq)("",!0)])):(0,a.kq)("",!0),"script"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",ne,[(0,a._)("span",ie,[(0,a._)("div",re,[(0,a._)("span",de,(0,o.zw)(Ie.getCardIndex(e.parent,e)),1),ce,l.stepInfo.inputDlg?((0,a.wg)(),(0,a.j4)(Ze,{key:0,modelValue:l.stepInfo.name,"onUpdate:modelValue":e=>l.stepInfo.name=e,onBlur:e=>Ie.cancelEditing(l.stepInfo),ref:"input",maxlength:"50",onClick:t[8]||(t[8]=(0,s.iM)((()=>{}),["stop"]))},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,a.wg)(),(0,a.j4)(Be,{key:1,class:"script-button",plain:"",type:"text",onClick:[e=>Ie.startEditing(l.stepInfo),t[9]||(t[9]=(0,s.iM)((()=>{}),["stop"]))]},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.name)+" ",1),pe])),_:2},1032,["onClick"]))])]),(0,a.wy)((0,a.Wm)(dt,{gutter:10,onClick:t[10]||(t[10]=(0,s.iM)((()=>{}),["stop"]))},{default:(0,a.w5)((()=>[(0,a.Wm)(Je,{span:18,style:{"margin-top":"15px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(it,{modelValue:l.stepInfo.script,"onUpdate:modelValue":e=>l.stepInfo.script=e,lang:"python",theme:"chrome"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,a.Wm)(Je,{span:6},{default:(0,a.w5)((()=>[(0,a.Wm)(rt,null,{default:(0,a.w5)((()=>[(0,a.Uk)("脚本模板")])),_:1}),(0,a._)("div",ue,[(0,a.Wm)(Be,{type:"success",size:"mini",plain:"",onClick:e=>Ie.addSetUptCodeMod(l.stepInfo,"func")},{default:(0,a.w5)((()=>[(0,a.Uk)("导入变量模块")])),_:2},1032,["onClick"])]),(0,a._)("div",me,[(0,a.Wm)(Be,{type:"success",size:"mini",plain:"",onClick:e=>Ie.addSetUptCodeMod(l.stepInfo,"ENV")},{default:(0,a.w5)((()=>[(0,a.Uk)("预设全局变量")])),_:2},1032,["onClick"])]),(0,a._)("div",fe,[(0,a.Wm)(Be,{type:"success",size:"mini",plain:"",onClick:e=>Ie.addSetUptCodeMod(l.stepInfo,"env")},{default:(0,a.w5)((()=>[(0,a.Uk)("预设局部变量")])),_:2},1032,["onClick"])]),(0,a._)("div",he,[(0,a.Wm)(Be,{type:"success",size:"mini",plain:"",onClick:e=>Ie.addSetUptCodeMod(l.stepInfo,"sql")},{default:(0,a.w5)((()=>[(0,a.Uk)("执行sql查询")])),_:2},1032,["onClick"])])])),_:2},1024)])),_:2},1536),[[s.F8,l.stepInfo.dlg]])])):(0,a.kq)("",!0),"sql"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",ge,[(0,a._)("span",we,[(0,a._)("div",ye,[(0,a._)("span",_e,(0,o.zw)(Ie.getCardIndex(e.parent,e)),1),ke,l.stepInfo.inputDlg?((0,a.wg)(),(0,a.j4)(Ze,{key:0,modelValue:l.stepInfo.name,"onUpdate:modelValue":e=>l.stepInfo.name=e,onBlur:e=>Ie.cancelEditing(l.stepInfo),ref:"input",maxlength:"50",onClick:t[11]||(t[11]=(0,s.iM)((()=>{}),["stop"]))},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,a.wg)(),(0,a.j4)(Be,{key:1,class:"script-button",plain:"",type:"text",onClick:[e=>Ie.startEditing(l.stepInfo),t[12]||(t[12]=(0,s.iM)((()=>{}),["stop"]))]},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.name)+" ",1),Ce])),_:2},1032,["onClick"]))])]),(0,a.wy)((0,a._)("div",be,ve,512),[[s.F8,l.stepInfo.dlg]])])):(0,a.kq)("",!0),"time"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",xe,[(0,a._)("span",We,[(0,a._)("div",De,[(0,a._)("span",Ue,(0,o.zw)(Ie.getCardIndex(e.parent,e)),1),Ve,(0,a.Wm)(nt,{modelValue:l.stepInfo.content.time,"onUpdate:modelValue":e=>l.stepInfo.content.time=e,min:0,max:999,size:"mini","controls-position":"right",placeholder:"秒"},null,8,["modelValue","onUpdate:modelValue"]),ze])])])):(0,a.kq)("",!0)])])),_:2},1024),(0,a.Wm)(Je,{span:4},{default:(0,a.w5)((()=>[(0,a._)("span",Se,[(0,a.Wm)(ct,{modelValue:l.status,"onUpdate:modelValue":e=>l.status=e,"inline-prompt":"",size:"small",onClick:e=>Ie.switchClick(l),style:{"--el-switch-on-color":"#53a8ff","--el-switch-off-color":"#f56c6c"}},null,8,["modelValue","onUpdate:modelValue","onClick"]),(0,a.Wm)(Be,{size:"mini",class:"el-icon-copy-document",onClick:e=>Ie.copyTree(l),circle:"",style:{"margin-left":"10px"}},null,8,["onClick"]),(0,a.Wm)(Be,{size:"mini",class:"el-icon-delete",type:"danger",onClick:e=>Ie.delTree(l),circle:""},null,8,["onClick"])])])),_:2},1024)])])),_:2},1032,["style"])):(0,a.kq)("",!0)])),_:1},8,["data","props","onNodeClick","allow-drop","onNodeDrop","node-drag-start"])])])),_:1})])),_:1})])),_:1}),oe.addApiDlg?((0,a.wg)(),(0,a.j4)(mt,{key:0,onChildEvent:Ie.handleChildData,onCloseModal:Ie.handleCloseModal},null,8,["onChildEvent","onCloseModal"])):(0,a.kq)("",!0),(0,a.Wm)(ht,{modelValue:oe.editCaseDlg,"onUpdate:modelValue":t[13]||(t[13]=e=>oe.editCaseDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a.Wm)(ft,{ref:"childRef",onCloseDrawer:Ie.handleClose,Interface_id:oe.Interface_id,copyDlg:oe.copyDlg,style:{padding:"0 10px"}},null,8,["onCloseDrawer","Interface_id","copyDlg"])])),_:1},8,["modelValue"]),(0,a.Wm)(ht,{modelValue:oe.ResultDlg,"onUpdate:modelValue":t[14]||(t[14]=e=>oe.ResultDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a._)("div",Te,[(0,a.Wm)(wt,{title:"执行结果",border:"",column:4,style:{"text-align":"center"}},{default:(0,a.w5)((()=>[(0,a.Wm)(gt,{label:"总数"},{default:(0,a.w5)((()=>[(0,a._)("b",Ee,(0,o.zw)(oe.runScentResult.all),1)])),_:1}),(0,a.Wm)(gt,{label:"通过"},{default:(0,a.w5)((()=>[(0,a._)("b",qe,(0,o.zw)(oe.runScentResult.success),1)])),_:1}),(0,a.Wm)(gt,{label:"失败"},{default:(0,a.w5)((()=>[(0,a._)("b",$e,(0,o.zw)(oe.runScentResult.fail),1)])),_:1}),(0,a.Wm)(gt,{label:"错误"},{default:(0,a.w5)((()=>[(0,a._)("b",Re,(0,o.zw)(oe.runScentResult.error),1)])),_:1})])),_:1}),Ae,(0,a.Wm)(ut,{height:"calc(100vh - 180px)"},{default:(0,a.w5)((()=>[(0,a.Wm)(kt,{data:oe.runScentResult.cases,style:{width:"100%"},"empty-text":"暂无数据"},{default:(0,a.w5)((()=>[(0,a.Wm)(_t,{type:"expand"},{default:(0,a.w5)((e=>[(0,a.Wm)(yt,{result:e.row},null,8,["result"])])),_:1}),(0,a.Wm)(_t,{label:"步骤名",prop:"name"}),(0,a.Wm)(_t,{label:"请求方法",prop:"method"},{default:(0,a.w5)((e=>["api"===e.row.type?((0,a.wg)(),(0,a.iD)("span",Fe,(0,o.zw)(e.row.method),1)):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(_t,{label:"响应状态码",prop:"status_cede"},{default:(0,a.w5)((e=>["api"===e.row.type?((0,a.wg)(),(0,a.iD)("span",je,(0,o.zw)(e.row.status_cede),1)):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(_t,{label:"执行结果",prop:"state","min-width":"40px"},{default:(0,a.w5)((e=>["成功"==e.row.state?((0,a.wg)(),(0,a.iD)("span",Me,(0,o.zw)(e.row.state),1)):"错误"==e.row.state?((0,a.wg)(),(0,a.iD)("span",Ne,(0,o.zw)(e.row.state),1)):((0,a.wg)(),(0,a.iD)("span",Oe,(0,o.zw)(e.row.state),1))])),_:1})])),_:1},8,["data"])])),_:1})])])),_:1},8,["modelValue"])],64)}l(70560);var Pe=l(20065),Le=l(37046);const He=e=>((0,a.dD)("data-v-2811cd9e"),e=e(),(0,a.Cn)(),e),Ke={style:{"margin-top":"20px"}},Ze={slot:"footer",class:"dialog-footer"},Ye={style:{"margin-bottom":"20px","margin-top":"40px","margin-right":"30px","font-size":"14px",color:"#909399"}},Ge={class:"interface-title"},Je={class:"style"},Qe={slot:"header",class:"card-title"},Xe={style:{"font-weight":"bold","margin-top":"-9px"}},et={key:0},tt={key:1},lt={key:2},at={key:3},ot={key:4},st={key:5},nt={class:"card-url"},it={class:"card-name"},rt={class:"card-content"},dt=He((()=>(0,a._)("b",null,"接口操作记录",-1))),ct={style:{"margin-top":"10px"}},pt={key:0},ut={style:{color:"#409eff","margin-right":"8px"}},mt={slot:"footer",class:"dialog-footer"};function ft(e,t,l,s,n,i){const r=(0,a.up)("treeNode"),d=(0,a.up)("el-col"),c=(0,a.up)("el-button"),p=(0,a.up)("el-input"),u=(0,a.up)("el-option"),m=(0,a.up)("el-select"),f=(0,a.up)("el-form-item"),h=(0,a.up)("el-form"),g=(0,a.up)("el-dialog"),w=(0,a.up)("el-table-column"),y=(0,a.up)("el-tag"),_=(0,a.up)("el-card"),k=(0,a.up)("el-table"),C=(0,a.up)("el-row"),b=(0,a.up)("el-scrollbar"),I=(0,a.up)("newEditCase"),v=(0,a.up)("el-drawer"),x=(0,a.up)("el-timeline-item"),W=(0,a.up)("el-timeline");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(g,{modelValue:n.addApiDlg,"onUpdate:modelValue":t[5]||(t[5]=e=>n.addApiDlg=e),title:"引用接口",width:"88%","before-close":i.clickClear,top:"0"},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{gutter:10},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{span:6},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{onTreeClick:i.handleTreeClick,handleTreeClick:i.handleTreeClick},null,8,["onTreeClick","handleTreeClick"])])),_:1}),(0,a.Wm)(d,{span:18},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{gutter:1,style:{"margin-bottom":"20px"}},{default:(0,a.w5)((()=>[(0,a._)("div",Ke,[(0,a.Wm)(p,{style:{width:"400px"},modelValue:n.filterText,"onUpdate:modelValue":t[0]||(t[0]=e=>n.filterText=e),placeholder:"请输入接口名称进行搜索",clearable:""},{append:(0,a.w5)((()=>[(0,a.Wm)(c,{type:"primary",onClick:i.handlenewInterfacesClick},{default:(0,a.w5)((()=>[(0,a.Uk)("查询")])),_:1},8,["onClick"])])),_:1},8,["modelValue"]),(0,a._)("div",null,[(0,a.Wm)(c,{type:"primary",style:{"margin-bottom":"20px","margin-top":"40px","margin-right":"10px"},onClick:i.userInterface,icon:"el-icon-view"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(i.buttonText),1)])),_:1},8,["onClick"]),(0,a.Wm)(c,{type:"primary",style:{"margin-bottom":"20px","margin-top":"40px","margin-right":"10px"},icon:"el-icon-star-off",onClick:t[1]||(t[1]=e=>n.dialogVisible=!0)},{default:(0,a.w5)((()=>[(0,a.Uk)("选择环境 ")])),_:1}),(0,a.Wm)(g,{modelValue:n.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>n.dialogVisible=e),width:"30%",title:"选择环境"},{footer:(0,a.w5)((()=>[(0,a._)("span",Ze,[(0,a.Wm)(c,{onClick:t[3]||(t[3]=e=>n.dialogVisible=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(c,{type:"primary",onClick:i.confirmSelection},{default:(0,a.w5)((()=>[(0,a.Uk)("确定")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(h,{rules:e.rulesinterface,ref:"interfaceRef"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{label:"测试环境",prop:"env"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{modelValue:n.selectedEnvironment,"onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedEnvironment=e),modelModifiers:{lazy:!0},placeholder:"请选择环境",style:{width:"70%"},"no-data-text":"暂无数据"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.testEnvs,(e=>((0,a.wg)(),(0,a.j4)(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules"])])),_:1},8,["modelValue"]),(0,a._)("span",Ye,[(0,a.Uk)("当前环境： "),(0,a.Wm)(c,{type:"info",disabled:"",plain:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(n.selectedEnvironmentName),1)])),_:1})]),(0,a.Wm)(c,{type:"warning",style:{"margin-bottom":"20px","margin-top":"40px",float:"right"},onClick:i.clickClear,icon:"el-icon-close"},{default:(0,a.w5)((()=>[(0,a.Uk)("关闭窗口 ")])),_:1},8,["onClick"]),(0,a.Wm)(c,{type:"primary",style:{"margin-bottom":"20px","margin-top":"40px",float:"right","margin-right":"15px"},onClick:i.handleApiClick,icon:"el-icon-check"},{default:(0,a.w5)((()=>[(0,a.Uk)("确认选择 ")])),_:1},8,["onClick"])]),(0,a._)("div",Ge,"全部接口共 ("+(0,o.zw)(n.interfaceCount)+") 个",1),(0,a.Wm)(b,{height:"calc(100vh)"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{"body-style":{width:"calc(100vh + 210px)"}},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,{span:24},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{ref:"multipleTable",data:n.tableData,"row-key":"ID","cell-style":{paddingTop:"4px",paddingBottom:"4px"},selectable:n.selectionConfig,onSelectionChange:i.handleSelectionChange},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{type:"selection"}),(0,a.Wm)(w,{align:"center"},{default:(0,a.w5)((e=>[(0,a.Wm)(_,{style:(0,o.j5)(i.getRowClassName(e.row.method))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{span:20},{default:(0,a.w5)((()=>[(0,a._)("div",Je,[(0,a._)("span",Qe,[(0,a._)("div",Xe,["POST"===e.row.method?((0,a.wg)(),(0,a.iD)("span",et,[(0,a.Wm)(y,{color:"#49cc90",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"GET"===e.row.method?((0,a.wg)(),(0,a.iD)("span",tt,[(0,a.Wm)(y,{color:"#61affe",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"PUT"===e.row.method?((0,a.wg)(),(0,a.iD)("span",lt,[(0,a.Wm)(y,{color:"#fca130",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"PATCH"===e.row.method?((0,a.wg)(),(0,a.iD)("span",at,[(0,a.Wm)(y,{color:"#50e3c2",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"DELETE"===e.row.method?((0,a.wg)(),(0,a.iD)("span",ot,[(0,a.Wm)(y,{color:"#f93e3e",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"DEAD"===e.row.method?((0,a.wg)(),(0,a.iD)("span",st,[(0,a.Wm)(y,{color:"rgb(201, 233, 104)",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0)]),(0,a._)("b",nt,(0,o.zw)(e.row.url),1),(0,a._)("span",it,(0,o.zw)(e.row.name),1)])])])),_:2},1024),(0,a.Wm)(d,{span:4},{default:(0,a.w5)((()=>[(0,a._)("span",rt,[(0,a.Wm)(c,{type:"text",size:"small",class:"card-button",onClick:t=>i.clickEditStep(e.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)(" 调试 ")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"text",size:"small",class:"card-button",onClick:t=>i.clickCopy(e.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)(" 复制 ")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"text",size:"mini",onClick:t=>i.clickDel(e.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)(" 删除 ")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"text",size:"small",class:"card-button",onClick:i.clickLog},{default:(0,a.w5)((()=>[(0,a.Uk)(" 操作记录 ")])),_:1},8,["onClick"])])])),_:2},1024)])),_:2},1032,["style"])])),_:1})])),_:1},8,["data","selectable","onSelectionChange"])])),_:1})])),_:1})])),_:1},8,["body-style"])])),_:1})])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","before-close"]),(0,a.Wm)(v,{modelValue:n.editCaseDlg,"onUpdate:modelValue":t[6]||(t[6]=e=>n.editCaseDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{ref:"childRef",onCloseDrawer:i.handleClose,Interface_id:n.Interface_id,copyDlg:n.copyDlg,style:{padding:"0 10px"}},null,8,["onCloseDrawer","Interface_id","copyDlg"])])),_:1},8,["modelValue"]),(0,a.Wm)(v,{modelValue:n.logDlg,"onUpdate:modelValue":t[7]||(t[7]=e=>n.logDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[dt,(0,a._)("div",ct,[(0,a.Wm)(W,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.bugLogs,((t,l)=>((0,a.wg)(),(0,a.j4)(x,{key:l,timestamp:e.$tools.rDate(t.create_time),placement:"top",color:"#0bbd87"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a._)("h4",null,(0,o.zw)(t.handle),1),t.remark?((0,a.wg)(),(0,a.iD)("p",pt,"变更记录："+(0,o.zw)(t.remark),1)):(0,a.kq)("",!0),(0,a._)("span",ut,(0,o.zw)(t.update_user),1),(0,a._)("span",null,"操作于 "+(0,o.zw)(e.$tools.rTime(t.create_time)),1)])),_:2},1024)])),_:2},1032,["timestamp"])))),128))])),_:1})])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(g,{modelValue:n.importDlg,"onUpdate:modelValue":t[9]||(t[9]=e=>n.importDlg=e),width:"30%",title:"导入接口"},{footer:(0,a.w5)((()=>[(0,a._)("span",mt,[(0,a.Wm)(c,{onClick:t[8]||(t[8]=e=>n.importDlg=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(c,{type:"primary",onClick:e.confirmSelection1},{default:(0,a.w5)((()=>[(0,a.Uk)("导入")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(h,{rules:e.rulesinterface,ref:"interfaceRef"},null,8,["rules"])])),_:1},8,["modelValue"])],64)}var ht=l(71955),gt=l(94717),wt={components:{treeNode:ht.Z,newEditCase:gt.Z},computed:{buttonText(){return this.showOnlySelf?"取消只看自己创建":"只看自己创建"},...(0,Pe.rn)(["pro","testEnvs","envId"]),username(){return window.sessionStorage.getItem("username")},env:{get(){return this.envId},set(e){this.selectEnv(e)}}},data(){return{addApiDlg:!0,treeId:"",filterText:"",tableData:[],editCaseDlg:!1,logDlg:!1,importDlg:!1,Interface_id:"",copyDlg:!1,showOnlySelf:!1,selectedOption:"",dialogVisible:!1,selectedEnvironment:"",selectedEnvironmentName:"暂未选择",selectionConfig:{selectedRowKeys:[],selectionChange:this.handleSelectionChange},bugLogs:[{create_time:"2024-02-18T10:30:00",handle:"修复了一个bug",remark:"这是修复bug的备注",update_user:"张三"},{create_time:"2024-02-17T14:20:00",handle:"重新测试了bug",remark:"接口名称登录变更为tms登录接口",update_user:"李四"},{create_time:"2024-02-16T09:45:00",handle:"提交了一个新的bug",update_user:"王五"}],interfaceCount:0}},methods:{...(0,Pe.OI)(["selectEnv"]),closeModal(){this.$emit("close-modal")},clickClear(){this.closeModal()},handleSelectionChange(e){this.selectionConfig.selectedRowKeys=e.map((e=>e.id))},getRowClassName(e){switch(e){case"GET":return"--el-card-border-color:#61affe;background-color:rgba(97,175,254,.1)";case"POST":return"--el-card-border-color:#49cc90;background-color:rgba(73,204,144,.1)";case"PUT":return"--el-card-border-color:#fca130;background-color:rgba(252,161,48,.1)";case"DELETE":return"--el-card-border-color:#f93e3e;background-color:rgba(249,62,62,.1)";case"PATCH":return"--el-card-border-color:#50e3c2;background-color:rgba(80,227,194,.1)";default:return""}},async handleTreeClick(e,t,l){if(t){const l=await this.$api.getnewInterfaces(e,t);200===l.status&&(this.treeId=e,this.tableData=l.data,this.interfaceCount=l.data.length)}else if(l){const a=await this.$api.getnewInterfaces(e,t,l);200===a.status&&(this.treeId=e,this.tableData=a.data,this.interfaceCount=a.data.length)}else{const t=await this.$api.getnewInterfaces(e);200===t.status&&(this.treeId=e,this.tableData=t.data,this.interfaceCount=t.data.length)}},async delInterface(e){const t=await this.$api.delnewInterface(e);204===t.status&&((0,Le.z8)({type:"success",message:"删除成功",duration:1e3}),this.handleTreeClick(this.treeId),this.filterText="",this.$refs.multipleTable.clearSelection())},handleApiClick(){if(0===this.selectionConfig.selectedRowKeys.length)return void(0,Le.z8)({type:"warning",message:"请勾选数据后再操作！",duration:2e3});const e=[...this.selectionConfig.selectedRowKeys];this.$emit("childEvent",e),this.filterText="",this.selectionConfig.selectedRowKeys=[],this.$refs.multipleTable.clearSelection(),this.clickClear()},handlenewInterfacesClick(){this.handleTreeClick(this.treeId,this.filterText)},clickDel(e){Le.T$.confirm("确定要删除该接口吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.delInterface(e)})).catch((()=>{(0,Le.z8)({type:"info",message:"取消删除",duration:1e3})}))},handleClose(){this.addCaseDlg=!1,this.editCaseDlg=!1,this.copyDlg=!1,this.handleTreeClick(this.treeId)},clickEditStep(e){this.Interface_id=e,this.editCaseDlg=!0,this.$nextTick((()=>{this.$refs.childRef.getInterfaceInfo(this.Interface_id)}))},clickCopy(e){this.copyDlg=!0,this.clickEditStep(e)},clickLog(){this.logDlg=!0},userInterface(){this.showOnlySelf=!this.showOnlySelf,this.showOnlySelf?this.handleTreeClick(this.treeId,"",this.username):this.handleTreeClick(this.treeId)},confirmSelection(){this.env=this.selectedEnvironment,this.selectedEnvironmentName=this.testEnvs.find((e=>e.id===this.selectedEnvironment)).name,this.dialogVisible=!1}}},yt=l(40089);const _t=(0,yt.Z)(wt,[["render",ft],["__scopeId","data-v-2811cd9e"]]);var kt=_t,Ct=l(81578),bt=l(62669),It={components:{apiCite:kt,newEditCase:gt.Z,caseResult:Ct.Z,Editor:bt.Z},data(){return{editForm:{name:"",project_id:"",desc:"",stepCount:0,creator:""},rulesCase:{name:[{required:!0,message:"请输入用例名称",trigger:"blur"}],project_id:[{required:!0,message:"请选择项目",trigger:"blur"}]},steps:[],addApiDlg:!1,editCaseDlg:!1,Interface_id:"",copyDlg:!1,ResultDlg:!1,runScentResult:"",ControllerData:{name:"",type:"",content:{},script:"",desc:"",creator:""},options:[{value:"equal",label:"等于"},{value:"notEqual",label:"不等于"},{value:"contains",label:"包含"},{value:"notContains",label:"不包含"},{value:"greaterThan",label:"大于"},{value:"lessThan",label:"小于"},{value:"greaterThanOrEqual",label:"大于等于"},{value:"lessThanOrEqual",label:"小于等于"},{value:"empty",label:"空"},{value:"notEmpty",label:"非空"}],test:""}},computed:{...(0,Pe.rn)(["pro","case","envId"]),username(){return window.sessionStorage.getItem("username")},defaultProps(){return{children:"children",label:"name"}}},watch:{steps:{deep:!0}},methods:{...(0,Pe.OI)(["CaseInfo","clearCaseInfo"]),getCardIndex(e,t){const l=e.childNodes.indexOf(t);return l+1},async addCaseSave(){this.$refs.CaseRef.validate((async e=>{if(!e)return;const t={...this.editForm};t.creator=this.username,t.project_id=this.pro.id;const l=await this.$api.createTestCase(t);201===l.status&&(0,Le.z8)({type:"success",message:"保存成功",duration:1e3})}))},async editCaseSave(){this.$refs.CaseRef.validate((async e=>{if(!e)return;const t={...this.editForm};t.project_id=this.pro.id,t.modifier=this.username,t.update_time=this.$tools.newTime(),delete t.create_time,delete t.creator,delete t.project;const l=await this.$api.updateTestCase(t.id,t);200===l.status&&((0,Le.z8)({type:"success",message:"保存成功",duration:1e3}),this.editStepSave())}))},async editStepSave(){const e=this.steps.filter((e=>e.stepInfo&&"api"!==e.stepInfo.type)).map((e=>e)),t=await this.$api.updatesStepControll(e);201===t.status&&this.getCaseStep(this.case.id)},reaiTime(){this.case?(this.editForm=this.case,this.editForm.project_id=this.pro.name):this.editForm.project_id=this.pro.name},goBack(){this.case&&this.case.back_type?(this.$router.push({name:"new-testplan"}),this.clearCaseInfo()):(this.$router.push({name:"TestCase"}),this.clearCaseInfo())},handleStepClick(e){"api"===e.stepInfo.type?(this.Interface_id=e.interfaceStep,this.editCaseDlg=!0,this.$nextTick((()=>{this.$refs.childRef.getInterfaceInfo(this.Interface_id)}))):("script"===e.stepInfo.type||"sql"===e.stepInfo.type)&&(e.stepInfo.dlg=!e.stepInfo.dlg)},handleClose(){this.addCaseDlg=!1,this.editCaseDlg=!1},getRowClassName(e){switch(e){case"api":return"--el-card-border-color:rgb(97, 100, 159);";case"if":return"--el-card-border-color:rgb(230, 162, 60);";case"for":return"--el-card-border-color:rgb(2, 167, 240);";case"script":return"--el-card-border-color:rgb(123, 77, 18);";case"time":return"--el-card-border-color:rgb(103, 194, 58);";case"sql":return"--el-card-border-color:rgb(120, 56, 135);";default:return""}},allowDrop(e,t,l){const a=["for","if"];return!!a.includes(t.data.stepInfo.type)||("prev"===l||"next"===l)},async copyTree(e){event.stopPropagation();let t=this.steps.length>0?this.steps.length+1:1;if("api"===e.stepInfo.type){const l=await this.$api.createTestCaseStep({case:this.case.id,interfaceStep:e.interfaceStep,sort:t,parent_id:e.parent_id});201===l.status&&this.getCaseStep(this.case.id)}else{const l=await this.$api.createStepControll(e.stepInfo);if(201===l.status){const a=await this.$api.createTestCaseStep({case:this.case.id,controllerStep:l.data.id,sort:t,parent_id:e.parent_id});201===a.status&&this.getCaseStep(this.case.id)}}},async delTree(e){if(event.stopPropagation(),"api"===e.stepInfo.type){const t=await this.$api.delTestCaseStep(e.id);204===t.status&&this.getCaseStep(this.case.id)}else{const t=await this.$api.delTestCaseStep(e.id);if(204===t.status){const t=await this.$api.delStepControll(e.controllerStep);204===t.status&&this.getCaseStep(this.case.id)}}},showApiCite(){this.$refs.CaseRef.validate((async e=>{e&&(this.addApiDlg=!0)}))},handleCloseModal(){this.addApiDlg=!1},async handleChildData(e){let t=this.steps.length>0?this.steps.length+1:1,l=[];e.forEach((e=>{let a={sort:t,case:this.case.id,interfaceStep:e};l.push(a),t++}));const a=await this.$api.createsTestCaseStep(l);201===a.status&&this.getCaseStep(this.case.id)},async getCaseStep(e){const t=await this.$api.getTestCaseStep(e);200===t.status&&(this.steps=t.data,this.editForm.stepCount=this.steps.length)},async switchClick(){event.stopPropagation(),this.updateStepOrder()},async updateStepOrder(){const e=(t,l,a)=>{t.sort=a,t.children&&t.children.length>0&&t.children.forEach(((l,a)=>{l.parent_id=t.id,l.sort=a+1,e(l,t.id,l.sort)}))};this.steps.forEach(((t,l)=>{t.sort=l+1,t.children&&t.children.length>0&&e(t,t.id,t.sort)}));const t=await this.$api.updateCaseStepOrder(this.steps);200===t.status&&(0,Le.bM)({duration:500,title:"调整成功",type:"success"})},async runCase(){if(this.envId){const e={env:this.envId,scene:this.case.id};(0,Le.bM)({title:"开始运行",message:"运行过程中请稍等片刻噢",type:"success",duration:1e3});const t=await this.$api.runCases(this.case.id,e);200==t.status&&(this.runScentResult=t.data,this.ResultDlg=!0)}else this.$message({type:"warning",message:"当前未选中执行环境!",duration:1e3})},toggleExpand(e){e.dlg=!e.dlg},startEditing(e){e.type,e.inputDlg=!0,this.$nextTick((()=>{this.$refs.input.focus()}))},cancelEditing(e){e.inputDlg=!1},addSetUptCodeMod(e,t){switch(t){case"ENV":e.script+='\n# 设置全局变量 \nBaseTest().save_global_variable("变量名","变量值")';break;case"env":e.script+='\n# 设置局部变量  \nBaseTest().save_env_variable("变量名","变量值")';break;case"func":e.script+="\nfrom apitestengine.core.cases import BaseTest";break;case"sql":e.script+='\n# ----执行sql语句(需要在环境中配置数据库连接信息)----\n# db.连接名.execute_all(sql语句) \nsql = "SELECT count(*) as count FROM futureloan.member"\nres = db.aliyun.execute_all(sql)';break}},handleDragScroll(){document.addEventListener("mousemove",(function(e){const t=e.clientY,l=document.querySelector(".el-tree").getBoundingClientRect().top;t<100&&l>0?window.scrollBy(0,-10):t>window.innerHeight-100&&window.scrollBy(0,10)}))},async AddController(e){let t=this.steps.length>0?this.steps.length+1:1;if("if"===e)this.ControllerData={name:"条件控制器",type:"if",content:{variable:"",JudgmentMode:"",value:""},script:"",desc:"",creator:this.username};else if("for"===e)this.ControllerData={name:"循环控制器",type:"for",content:{select:"count",cycleIndex:"",cycleInterval:"",variable:"",variableName:""},script:"",desc:"",creator:this.username};else if("script"===e)this.ControllerData={name:"自定义脚本",type:"script",content:{},script:"",desc:"",creator:this.username};else if("time"===e)this.ControllerData={name:"定时控制器",type:"time",content:{time:""},script:"",desc:"",creator:this.username};else{if("sql"!==e)throw new Error("types is not defined");this.ControllerData={name:"数据库操作",type:"sql",content:{},script:"",desc:"",creator:this.username}}const l=await this.$api.createStepControll(this.ControllerData);if(201===l.status){const e=await this.$api.createTestCaseStep({case:this.case.id,controllerStep:l.data.id,sort:t});201===e.status&&this.getCaseStep(this.case.id)}}},created(){this.reaiTime(),this.case&&this.case.id&&this.getCaseStep(this.case.id)}};const vt=(0,yt.Z)(It,[["render",Be],["__scopeId","data-v-d021862e"]]);var xt=vt}}]);
//# sourceMappingURL=378.2d067442.js.map