"use strict";(self["webpackChunkfrontend_web"]=self["webpackChunkfrontend_web"]||[]).push([[991],{75247:function(e,t,l){l.r(t),l.d(t,{default:function(){return kt}});var a=l(73396),o=l(87139),s=l(49242);const n=e=>((0,a.dD)("data-v-a9ac6be4"),e=e(),(0,a.Cn)(),e),i={slot:"header"},d={style:{display:"flex","justify-content":"space-between","align-items":"center",height:"2px"}},r={style:{"margin-right":"15px"}},c={style:{"margin-left":"15px","font-weight":"bold"}},p={class:"tree-component"},u={style:{color:"#00aaff","font-weight":"bold"}},m={class:"stepStyle"},h={style:{"margin-left":"20px"}},f={slot:"header"},g={class:"style"},w={key:0},y={slot:"header",class:"card-title"},k={style:{"font-weight":"bold","margin-top":"-9px"}},_={class:"icon",style:{color:"rgb(97, 100, 159)"}},C={style:{"min-width":"60px",display:"inline-block"}},b={key:0},x={style:{color:"#49cc90","font-size":"15px"}},I={key:1},v={style:{color:"#61affe","font-size":"15px"}},W={key:2},D={style:{color:"#fca130","font-size":"15px"}},V={key:3},U={style:{color:"#50e3c2","font-size":"15px"}},z={key:4},S={style:{color:"#f93e3e","font-size":"15px"}},T={key:5},E={style:{color:"rgb(201, 233, 104)","font-size":"15px"}},q={class:"card-url"},$={class:"card-name"},R={key:1},F={slot:"header",class:"card-title"},j={style:{"margin-top":"-9px"}},M={class:"icon",style:{color:"rgb(230, 162, 60)"}},A=["onClick"],O={slot:"header",class:"card-title"},N={style:{"margin-top":"-12px"}},P={class:"icon",style:{color:"rgb(2, 167, 240)"}},B={key:0},H={class:"loop"},K=n((()=>(0,a._)("span",{style:{"padding-right":"5px"}},"循环次数",-1))),L=n((()=>(0,a._)("span",{style:{"padding-right":"5px","padding-left":"10px"}},"循环间隔",-1))),Y=n((()=>(0,a._)("span",{style:{"margin-left":"10px"}},"秒",-1))),Z={key:1},G={class:"loop"},J=n((()=>(0,a._)("b",{style:{"margin-left":"10px","margin-right":"10px"}},"in",-1))),Q=n((()=>(0,a._)("span",{style:{"padding-right":"5px","padding-left":"10px"}},"循环间隔",-1))),X=n((()=>(0,a._)("span",{style:{"margin-left":"10px"}},"秒",-1))),ee={key:2},te=n((()=>(0,a._)("div",{class:"loop"},"敬请期待！",-1))),le=[te],ae={key:3},oe={slot:"header",class:"card-title"},se={style:{"margin-top":"-9px"}},ne={class:"icon",style:{color:"rgb(123, 77, 18)"}},ie=n((()=>(0,a._)("i",{class:"el-icon-edit"},null,-1))),de={class:"code_mod"},re={class:"code_mod"},ce={class:"code_mod"},pe={class:"code_mod"},ue={key:4},me={slot:"header",class:"card-title"},he={style:{"margin-top":"-9px"}},fe={class:"icon",style:{color:"rgb(120, 56, 135)"}},ge=n((()=>(0,a._)("i",{class:"el-icon-edit"},null,-1))),we={style:{"margin-left":"50%","margin-top":"30px"}},ye=n((()=>(0,a._)("i",null,"该功能敬请期待噢！",-1))),ke=[ye],_e={key:5},Ce={slot:"header",class:"card-title"},be={style:{"margin-top":"-9px"}},xe={class:"icon",style:{color:"rgb(103, 194, 58)"}},Ie=n((()=>(0,a._)("span",{style:{"margin-left":"10px"}},"秒",-1))),ve={class:"card-content"},We={style:{padding:"20px"}},De={style:{color:"#00aaff"}},Ve={style:{color:"#00aa7f"}},Ue={style:{color:"orangered"}},ze={style:{color:"#fca130"}},Se=n((()=>(0,a._)("div",{style:{height:"40px","line-height":"40px"}},[(0,a._)("b",null,"执行详情")],-1))),Te={key:0},Ee={key:0},qe={key:0,style:{color:"#00AA7F"}},$e={key:1,style:{color:"#F56C6C"}},Re={key:2,style:{color:"#fca130"}};function Fe(e,t,l,n,te,ye){const Fe=(0,a.up)("el-button"),je=(0,a.up)("el-card"),Me=(0,a.up)("el-input"),Ae=(0,a.up)("el-form-item"),Oe=(0,a.up)("el-form"),Ne=(0,a.up)("el-col"),Pe=(0,a.up)("el-tag"),Be=(0,a.up)("el-tooltip"),He=(0,a.up)("el-dropdown-item"),Ke=(0,a.up)("el-dropdown-menu"),Le=(0,a.up)("el-dropdown"),Ye=(0,a.up)("el-option"),Ze=(0,a.up)("el-select"),Ge=(0,a.up)("el-radio"),Je=(0,a.up)("el-radio-group"),Qe=(0,a.up)("el-input-number"),Xe=(0,a.up)("Editor"),et=(0,a.up)("el-divider"),tt=(0,a.up)("el-row"),lt=(0,a.up)("el-switch"),at=(0,a.up)("el-tree"),ot=(0,a.up)("el-scrollbar"),st=(0,a.up)("apiCite"),nt=(0,a.up)("newEditCase"),it=(0,a.up)("el-drawer"),dt=(0,a.up)("el-descriptions-item"),rt=(0,a.up)("el-descriptions"),ct=(0,a.up)("caseResult"),pt=(0,a.up)("el-table-column"),ut=(0,a.up)("el-table");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(je,null,{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a._)("div",d,[(0,a._)("div",r,[(0,a.Wm)(Fe,{size:"large",type:"text",icon:"el-icon-caret-left",onClick:ye.goBack},{default:(0,a.w5)((()=>[(0,a.Uk)("返回")])),_:1},8,["onClick"]),(0,a._)("span",c,(0,o.zw)(null!==this.case?"编辑用例":"新增用例"),1)]),(0,a._)("div",null,[te.isExpand?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(Fe,{key:0,icon:"el-icon-sort",type:"primary",onClick:t[0]||(t[0]=e=>ye.rowOpenORFold(!0)),round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("展开全部")])),_:1})),te.isExpand?((0,a.wg)(),(0,a.j4)(Fe,{key:1,icon:"el-icon-sort",type:"primary",onClick:t[1]||(t[1]=e=>ye.rowOpenORFold(!1)),round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("折叠全部")])),_:1})):(0,a.kq)("",!0),(0,a.Wm)(Fe,{icon:"el-icon-bug",type:"success",onClick:ye.runCase,round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("调试")])),_:1},8,["onClick"]),this.case?((0,a.wg)(),(0,a.j4)(Fe,{key:2,type:"primary",onClick:ye.editCaseSave,round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("保存")])),_:1},8,["onClick"])):((0,a.wg)(),(0,a.j4)(Fe,{key:3,type:"primary",onClick:ye.addCaseSave,round:""},{default:(0,a.w5)((()=>[(0,a.Uk)("保存")])),_:1},8,["onClick"]))])])])])),_:1}),(0,a.Wm)(tt,{gutter:10},{default:(0,a.w5)((()=>[(0,a.Wm)(Ne,{span:6},{default:(0,a.w5)((()=>[(0,a._)("div",p,[(0,a.Wm)(Oe,{model:te.editForm,rules:te.rulesCase,ref:"CaseRef","label-width":"80px",style:{"max-width":"500px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(Ae,{label:"用例名称",prop:"name",size:"mini"},{default:(0,a.w5)((()=>[(0,a.Wm)(Me,{modelValue:te.editForm.name,"onUpdate:modelValue":t[2]||(t[2]=e=>te.editForm.name=e),placeholder:"请输入用例名称"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(Ae,{prop:"project_id",label:"所属项目",size:"mini"},{default:(0,a.w5)((()=>[(0,a.Wm)(Me,{modelValue:te.editForm.project_id,"onUpdate:modelValue":t[3]||(t[3]=e=>te.editForm.project_id=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(Ae,{label:"用例描述",prop:"desc"},{default:(0,a.w5)((()=>[(0,a.Wm)(Me,{type:"textarea",modelValue:te.editForm.desc,"onUpdate:modelValue":t[4]||(t[4]=e=>te.editForm.desc=e),placeholder:"请输入备注"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(Ae,{label:"步骤总数：","label-width":"93px"},{default:(0,a.w5)((()=>[(0,a._)("div",u,(0,o.zw)(te.editForm.stepCount),1)])),_:1})])),_:1},8,["model","rules"])])])),_:1}),(0,a.Wm)(Ne,{span:18},{default:(0,a.w5)((()=>[(0,a._)("div",m,[(0,a.Wm)(Pe,{class:"el-icon-plus",color:"#61649f",style:{"margin-right":"10px",width:"100px"},onClick:ye.showApiCite},{default:(0,a.w5)((()=>[(0,a.Uk)("HTTP请求")])),_:1},8,["onClick"]),(0,a.Wm)(Pe,{class:"el-icon-plus",color:"#E6A23C",style:{"margin-right":"10px",width:"100px"},onClick:t[5]||(t[5]=e=>ye.AddController("if"))},{default:(0,a.w5)((()=>[(0,a.Uk)("条件控制器")])),_:1}),(0,a.Wm)(Pe,{class:"el-icon-plus",color:"#02A7F0FF",style:{"margin-right":"10px",width:"100px"},onClick:t[6]||(t[6]=e=>ye.AddController("for"))},{default:(0,a.w5)((()=>[(0,a.Uk)("循环控制器")])),_:1}),(0,a.Wm)(Pe,{class:"el-icon-plus",color:"#7B4D12FF",style:{"margin-right":"10px",width:"100px"},onClick:t[7]||(t[7]=e=>ye.AddController("script"))},{default:(0,a.w5)((()=>[(0,a.Uk)("自定义脚本")])),_:1}),(0,a.Wm)(Pe,{class:"el-icon-plus",color:"#783887FF",style:{"margin-right":"10px",width:"100px"},onClick:t[8]||(t[8]=e=>ye.AddController("sql"))},{default:(0,a.w5)((()=>[(0,a.Uk)("SQL控制器")])),_:1}),(0,a.Wm)(Pe,{class:"el-icon-plus",color:"#67C23AFF",style:{"margin-right":"10px",width:"100px"},onClick:t[9]||(t[9]=e=>ye.AddController("time"))},{default:(0,a.w5)((()=>[(0,a.Uk)("等待控制器")])),_:1})]),(0,a.Wm)(ot,{height:"calc(100vh - 155px)"},{default:(0,a.w5)((()=>[(0,a._)("div",h,[((0,a.wg)(),(0,a.j4)(at,{data:te.steps,props:ye.defaultProps,draggable:"",key:te.treeKey,"default-expand-all":te.isExpand,"expand-on-click-node":!1,onNodeClick:ye.handleStepClick,"allow-drop":ye.allowDrop,onNodeDrop:ye.updateStepOrder,"node-drag-start":ye.handleDragScroll},{default:(0,a.w5)((({node:e,data:l})=>[l.stepInfo?((0,a.wg)(),(0,a.j4)(je,{key:0},{default:(0,a.w5)((()=>[(0,a._)("div",f,[(0,a.Wm)(Ne,{span:20},{default:(0,a.w5)((()=>[(0,a._)("div",g,["api"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("span",y,[(0,a._)("div",k,[(0,a._)("span",_,(0,o.zw)(ye.getCardIndex(e.parent,e)),1),(0,a.Wm)(Pe,{color:"#61649f",style:{"margin-right":"20px",height:"25px","font-size":"12px","line-height":"25px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("HTTP请求")])),_:1}),(0,a._)("span",C,["POST"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",b,[(0,a._)("b",x,(0,o.zw)(l.stepInfo.method),1)])):(0,a.kq)("",!0),"GET"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",I,[(0,a._)("b",v,(0,o.zw)(l.stepInfo.method),1)])):(0,a.kq)("",!0),"PUT"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",W,[(0,a._)("b",D,(0,o.zw)(l.stepInfo.method),1)])):(0,a.kq)("",!0),"PATCH"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",V,[(0,a._)("b",U,(0,o.zw)(l.stepInfo.method),1)])):(0,a.kq)("",!0),"DELETE"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",z,[(0,a._)("b",S,(0,o.zw)(l.stepInfo.method),1)])):(0,a.kq)("",!0),"DEAD"===l.stepInfo.method?((0,a.wg)(),(0,a.iD)("span",T,[(0,a._)("b",E,(0,o.zw)(l.stepInfo.method),1)])):(0,a.kq)("",!0)])]),(0,a.Wm)(Le,{trigger:"click",onClick:t[12]||(t[12]=(0,s.iM)((()=>{}),["stop"]))},{dropdown:(0,a.w5)((()=>[(0,a.Wm)(Ke,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(ye.testEnvsWithDefault,(e=>((0,a.wg)(),(0,a.j4)(He,{key:e.id,command:"api",onClick:t=>ye.envClick(e,l.stepInfo)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.name),1)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])),default:(0,a.w5)((()=>[0!==Object.keys(l.stepInfo.host).length?((0,a.wg)(),(0,a.j4)(Be,{key:0,class:"box-item",effect:"dark",content:l.stepInfo.host.host,placement:"top"},{default:(0,a.w5)((()=>[(0,a.Wm)(Fe,{style:{"margin-top":"-13px","margin-bottom":"-2px"},type:"text",size:"max",onClick:t[10]||(t[10]=(0,s.iM)((()=>{}),["stop"]))},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.host.name),1)])),_:2},1024)])),_:2},1032,["content"])):((0,a.wg)(),(0,a.j4)(Be,{key:1,class:"box-item",effect:"dark",content:"默认环境host",placement:"top"},{default:(0,a.w5)((()=>[(0,a.Wm)(Fe,{style:{"margin-top":"-13px","margin-bottom":"-2px"},type:"text",size:"max",onClick:t[11]||(t[11]=(0,s.iM)((()=>{}),["stop"]))},{default:(0,a.w5)((()=>[(0,a.Uk)("默认环境")])),_:1})])),_:1}))])),_:2},1024),(0,a._)("b",q,(0,o.zw)(l.stepInfo.url),1),(0,a._)("span",$,(0,o.zw)(l.stepInfo.name),1)])])):(0,a.kq)("",!0),"if"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",R,[(0,a._)("span",F,[(0,a._)("div",j,[(0,a._)("span",M,(0,o.zw)(ye.getCardIndex(e.parent,e)),1),(0,a.Wm)(Pe,{color:"rgb(230, 162, 60)",style:{"font-weight":"bold","margin-right":"20px",height:"25px","font-size":"12px","line-height":"25px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("条件控制器")])),_:1}),(0,a._)("span",null,[(0,a.Wm)(Me,{class:"input-def",placeholder:"变量，例如{{name}}",modelValue:l.stepInfo.content.variable,"onUpdate:modelValue":e=>l.stepInfo.content.variable=e},null,8,["modelValue","onUpdate:modelValue"]),(0,a.Wm)(Ze,{modelValue:l.stepInfo.content.JudgmentMode,"onUpdate:modelValue":e=>l.stepInfo.content.JudgmentMode=e,placeholder:"请选择",size:"small",style:{"margin-right":"8px",width:"100px"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(te.options,(e=>((0,a.wg)(),(0,a.j4)(Ye,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,a.Wm)(Me,{class:"input-def",placeholder:"值",modelValue:l.stepInfo.content.value,"onUpdate:modelValue":e=>l.stepInfo.content.value=e},null,8,["modelValue","onUpdate:modelValue"]),(0,a.Wm)(Me,{class:"input-def",placeholder:"备注",modelValue:l.stepInfo.desc,"onUpdate:modelValue":e=>l.stepInfo.desc=e},null,8,["modelValue","onUpdate:modelValue"])])])])])):(0,a.kq)("",!0),"for"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",{key:2,onClick:e=>ye.toggleExpand(l.stepInfo)},[(0,a._)("span",O,[(0,a._)("div",N,[(0,a._)("span",P,(0,o.zw)(ye.getCardIndex(e.parent,e)),1),(0,a.Wm)(Pe,{color:"rgb(2, 167, 240)",style:{"font-weight":"bold","margin-right":"20px",height:"25px","font-size":"12px","line-height":"25px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("循环控制器")])),_:1}),(0,a.Wm)(Je,{modelValue:l.stepInfo.content.select,"onUpdate:modelValue":e=>l.stepInfo.content.select=e,onClick:t[13]||(t[13]=(0,s.iM)((()=>{}),["stop"]))},{default:(0,a.w5)((()=>[(0,a.Wm)(Ge,{label:"count",value:"count"},{default:(0,a.w5)((()=>[(0,a.Uk)("次数循环")])),_:1}),(0,a.Wm)(Ge,{label:"for",value:"for"},{default:(0,a.w5)((()=>[(0,a.Uk)("for循环")])),_:1}),(0,a.Wm)(Ge,{label:"while",value:"while",disabled:""},{default:(0,a.w5)((()=>[(0,a.Uk)("while循环")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])]),l.stepInfo.dlg?((0,a.wg)(),(0,a.iD)("div",{key:l.id,onClick:t[14]||(t[14]=(0,s.iM)((()=>{}),["stop"]))},["count"===l.stepInfo.content.select||""===l.stepInfo.content.select?((0,a.wg)(),(0,a.iD)("div",B,[(0,a._)("div",H,[K,(0,a.Wm)(Me,{modelValue:l.stepInfo.content.cycleIndex,"onUpdate:modelValue":e=>l.stepInfo.content.cycleIndex=e,style:{width:"200px"},placeholder:"循环次数"},null,8,["modelValue","onUpdate:modelValue"]),L,(0,a.Wm)(Qe,{modelValue:l.stepInfo.content.cycleInterval,"onUpdate:modelValue":e=>l.stepInfo.content.cycleInterval=e,min:0,max:999,size:"small","controls-position":"right",placeholder:"秒"},null,8,["modelValue","onUpdate:modelValue"]),Y])])):(0,a.kq)("",!0),"for"===l.stepInfo.content.select?((0,a.wg)(),(0,a.iD)("div",Z,[(0,a._)("div",G,[(0,a.Wm)(Me,{style:{width:"200px"},placeholder:"定义变量名称",modelValue:l.stepInfo.content.variableName,"onUpdate:modelValue":e=>l.stepInfo.content.variableName=e},null,8,["modelValue","onUpdate:modelValue"]),J,(0,a.Wm)(Me,{style:{width:"200px"},placeholder:"变量，例如{{name}}",modelValue:l.stepInfo.content.variable,"onUpdate:modelValue":e=>l.stepInfo.content.variable=e},null,8,["modelValue","onUpdate:modelValue"]),Q,(0,a.Wm)(Qe,{modelValue:l.stepInfo.content.cycleInterval,"onUpdate:modelValue":e=>l.stepInfo.content.cycleInterval=e,min:0,max:999,size:"small","controls-position":"right",placeholder:"秒"},null,8,["modelValue","onUpdate:modelValue"]),X])])):(0,a.kq)("",!0),"while"===l.stepInfo.content.select?((0,a.wg)(),(0,a.iD)("div",ee,le)):(0,a.kq)("",!0)])):(0,a.kq)("",!0)],8,A)):(0,a.kq)("",!0),"script"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",ae,[(0,a._)("span",oe,[(0,a._)("div",se,[(0,a._)("span",ne,(0,o.zw)(ye.getCardIndex(e.parent,e)),1),(0,a.Wm)(Pe,{color:"rgb(123, 77, 18)",style:{"font-weight":"bold","margin-right":"20px",height:"25px","font-size":"12px","line-height":"25px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("自定义脚本")])),_:1}),l.stepInfo.inputDlg?((0,a.wg)(),(0,a.j4)(Me,{key:0,modelValue:l.stepInfo.name,"onUpdate:modelValue":e=>l.stepInfo.name=e,onBlur:e=>ye.cancelEditing(l.stepInfo),ref:"input",maxlength:"50",onClick:t[15]||(t[15]=(0,s.iM)((()=>{}),["stop"]))},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,a.wg)(),(0,a.j4)(Fe,{key:1,class:"script-button",plain:"",type:"text",onClick:[e=>ye.startEditing(l.stepInfo),t[16]||(t[16]=(0,s.iM)((()=>{}),["stop"]))]},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.name)+" ",1),ie])),_:2},1032,["onClick"]))])]),(0,a.wy)((0,a.Wm)(tt,{gutter:10,onClick:t[17]||(t[17]=(0,s.iM)((()=>{}),["stop"]))},{default:(0,a.w5)((()=>[(0,a.Wm)(Ne,{span:18,style:{"margin-top":"15px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(Xe,{modelValue:l.stepInfo.script,"onUpdate:modelValue":e=>l.stepInfo.script=e,lang:"python",theme:"chrome"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,a.Wm)(Ne,{span:6},{default:(0,a.w5)((()=>[(0,a.Wm)(et,null,{default:(0,a.w5)((()=>[(0,a.Uk)("脚本模板")])),_:1}),(0,a._)("div",de,[(0,a.Wm)(Fe,{type:"success",size:"mini",plain:"",onClick:e=>ye.addSetUptCodeMod(l.stepInfo,"func")},{default:(0,a.w5)((()=>[(0,a.Uk)("导入变量模块")])),_:2},1032,["onClick"])]),(0,a._)("div",re,[(0,a.Wm)(Fe,{type:"success",size:"mini",plain:"",onClick:e=>ye.addSetUptCodeMod(l.stepInfo,"ENV")},{default:(0,a.w5)((()=>[(0,a.Uk)("预设全局变量")])),_:2},1032,["onClick"])]),(0,a._)("div",ce,[(0,a.Wm)(Fe,{type:"success",size:"mini",plain:"",onClick:e=>ye.addSetUptCodeMod(l.stepInfo,"env")},{default:(0,a.w5)((()=>[(0,a.Uk)("预设局部变量")])),_:2},1032,["onClick"])]),(0,a._)("div",pe,[(0,a.Wm)(Fe,{type:"success",size:"mini",plain:"",onClick:e=>ye.addSetUptCodeMod(l.stepInfo,"sql")},{default:(0,a.w5)((()=>[(0,a.Uk)("执行sql查询")])),_:2},1032,["onClick"])])])),_:2},1024)])),_:2},1536),[[s.F8,l.stepInfo.dlg]])])):(0,a.kq)("",!0),"sql"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",ue,[(0,a._)("span",me,[(0,a._)("div",he,[(0,a._)("span",fe,(0,o.zw)(ye.getCardIndex(e.parent,e)),1),(0,a.Wm)(Pe,{color:"rgb(120, 56, 135)",style:{"font-weight":"bold","margin-right":"20px",height:"25px","font-size":"12px","line-height":"25px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("SQL控制器")])),_:1}),l.stepInfo.inputDlg?((0,a.wg)(),(0,a.j4)(Me,{key:0,modelValue:l.stepInfo.name,"onUpdate:modelValue":e=>l.stepInfo.name=e,onBlur:e=>ye.cancelEditing(l.stepInfo),ref:"input",maxlength:"50",onClick:t[18]||(t[18]=(0,s.iM)((()=>{}),["stop"]))},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,a.wg)(),(0,a.j4)(Fe,{key:1,class:"script-button",plain:"",type:"text",onClick:[e=>ye.startEditing(l.stepInfo),t[19]||(t[19]=(0,s.iM)((()=>{}),["stop"]))]},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.stepInfo.name)+" ",1),ge])),_:2},1032,["onClick"]))])]),(0,a.wy)((0,a._)("div",we,ke,512),[[s.F8,l.stepInfo.dlg]])])):(0,a.kq)("",!0),"time"===l.stepInfo.type?((0,a.wg)(),(0,a.iD)("div",_e,[(0,a._)("span",Ce,[(0,a._)("div",be,[(0,a._)("span",xe,(0,o.zw)(ye.getCardIndex(e.parent,e)),1),(0,a.Wm)(Pe,{color:"rgb(103, 194, 58)",style:{"font-weight":"bold","margin-right":"20px",height:"25px","font-size":"12px","line-height":"25px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("等待控制器")])),_:1}),(0,a.Wm)(Qe,{modelValue:l.stepInfo.content.time,"onUpdate:modelValue":e=>l.stepInfo.content.time=e,min:0,max:999,size:"mini","controls-position":"right",placeholder:"秒"},null,8,["modelValue","onUpdate:modelValue"]),Ie])])])):(0,a.kq)("",!0)])])),_:2},1024),(0,a.Wm)(Ne,{span:4},{default:(0,a.w5)((()=>[(0,a._)("span",ve,[(0,a.Wm)(lt,{modelValue:l.status,"onUpdate:modelValue":e=>l.status=e,"inline-prompt":"",size:"small",onClick:e=>ye.switchClick(l),style:{"--el-switch-on-color":"#53a8ff","--el-switch-off-color":"#f56c6c"}},null,8,["modelValue","onUpdate:modelValue","onClick"]),(0,a.Wm)(Fe,{size:"mini",class:"el-icon-copy-document",onClick:e=>ye.copyTree(l),circle:"",style:{"margin-left":"10px"}},null,8,["onClick"]),(0,a.Wm)(Fe,{size:"mini",class:"el-icon-delete",type:"danger",onClick:e=>ye.delTree(l),circle:""},null,8,["onClick"])])])),_:2},1024)])])),_:2},1024)):(0,a.kq)("",!0)])),_:1},8,["data","props","default-expand-all","onNodeClick","allow-drop","onNodeDrop","node-drag-start"]))])])),_:1})])),_:1})])),_:1}),te.addApiDlg?((0,a.wg)(),(0,a.j4)(st,{key:0,onChildEvent:ye.handleChildData,onCloseModal:ye.handleCloseModal},null,8,["onChildEvent","onCloseModal"])):(0,a.kq)("",!0),(0,a.Wm)(it,{modelValue:te.editCaseDlg,"onUpdate:modelValue":t[20]||(t[20]=e=>te.editCaseDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a.Wm)(nt,{ref:"childRef",onCloseDrawer:ye.handleClose,Interface_id:te.Interface_id,copyDlg:te.copyDlg,style:{padding:"0 10px"}},null,8,["onCloseDrawer","Interface_id","copyDlg"])])),_:1},8,["modelValue"]),(0,a.Wm)(it,{modelValue:te.ResultDlg,"onUpdate:modelValue":t[21]||(t[21]=e=>te.ResultDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a._)("div",We,[(0,a.Wm)(rt,{title:"执行结果",border:"",column:4,style:{"text-align":"center"}},{default:(0,a.w5)((()=>[(0,a.Wm)(dt,{label:"总数"},{default:(0,a.w5)((()=>[(0,a._)("b",De,(0,o.zw)(te.runScentResult.all),1)])),_:1}),(0,a.Wm)(dt,{label:"通过"},{default:(0,a.w5)((()=>[(0,a._)("b",Ve,(0,o.zw)(te.runScentResult.success),1)])),_:1}),(0,a.Wm)(dt,{label:"失败"},{default:(0,a.w5)((()=>[(0,a._)("b",Ue,(0,o.zw)(te.runScentResult.fail),1)])),_:1}),(0,a.Wm)(dt,{label:"错误"},{default:(0,a.w5)((()=>[(0,a._)("b",ze,(0,o.zw)(te.runScentResult.error),1)])),_:1})])),_:1}),Se,(0,a.Wm)(ot,{height:"calc(100vh - 180px)"},{default:(0,a.w5)((()=>[(0,a.Wm)(ut,{data:te.runScentResult.cases,style:{width:"100%"},"empty-text":"暂无数据"},{default:(0,a.w5)((()=>[(0,a.Wm)(pt,{type:"expand"},{default:(0,a.w5)((e=>[(0,a.Wm)(ct,{result:e.row},null,8,["result"])])),_:1}),(0,a.Wm)(pt,{label:"步骤名",prop:"name"}),(0,a.Wm)(pt,{label:"请求方法",prop:"method"},{default:(0,a.w5)((e=>["api"===e.row.type?((0,a.wg)(),(0,a.iD)("span",Te,(0,o.zw)(e.row.method),1)):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(pt,{label:"响应状态码",prop:"status_cede"},{default:(0,a.w5)((e=>["api"===e.row.type?((0,a.wg)(),(0,a.iD)("span",Ee,(0,o.zw)(e.row.status_cede),1)):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(pt,{label:"执行结果",prop:"state","min-width":"40px"},{default:(0,a.w5)((e=>["成功"==e.row.state?((0,a.wg)(),(0,a.iD)("span",qe,(0,o.zw)(e.row.state),1)):"错误"==e.row.state?((0,a.wg)(),(0,a.iD)("span",$e,(0,o.zw)(e.row.state),1)):((0,a.wg)(),(0,a.iD)("span",Re,(0,o.zw)(e.row.state),1))])),_:1})])),_:1},8,["data"])])),_:1})])])),_:1},8,["modelValue"])],64)}l(70560);var je=l(20065),Me=l(37046);const Ae=e=>((0,a.dD)("data-v-2811cd9e"),e=e(),(0,a.Cn)(),e),Oe={style:{"margin-top":"20px"}},Ne={slot:"footer",class:"dialog-footer"},Pe={style:{"margin-bottom":"20px","margin-top":"40px","margin-right":"30px","font-size":"14px",color:"#909399"}},Be={class:"interface-title"},He={class:"style"},Ke={slot:"header",class:"card-title"},Le={style:{"font-weight":"bold","margin-top":"-9px"}},Ye={key:0},Ze={key:1},Ge={key:2},Je={key:3},Qe={key:4},Xe={key:5},et={class:"card-url"},tt={class:"card-name"},lt={class:"card-content"},at=Ae((()=>(0,a._)("b",null,"接口操作记录",-1))),ot={style:{"margin-top":"10px"}},st={key:0},nt={style:{color:"#409eff","margin-right":"8px"}},it={slot:"footer",class:"dialog-footer"};function dt(e,t,l,s,n,i){const d=(0,a.up)("treeNode"),r=(0,a.up)("el-col"),c=(0,a.up)("el-button"),p=(0,a.up)("el-input"),u=(0,a.up)("el-option"),m=(0,a.up)("el-select"),h=(0,a.up)("el-form-item"),f=(0,a.up)("el-form"),g=(0,a.up)("el-dialog"),w=(0,a.up)("el-table-column"),y=(0,a.up)("el-tag"),k=(0,a.up)("el-card"),_=(0,a.up)("el-table"),C=(0,a.up)("el-row"),b=(0,a.up)("el-scrollbar"),x=(0,a.up)("newEditCase"),I=(0,a.up)("el-drawer"),v=(0,a.up)("el-timeline-item"),W=(0,a.up)("el-timeline");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(g,{modelValue:n.addApiDlg,"onUpdate:modelValue":t[5]||(t[5]=e=>n.addApiDlg=e),title:"引用接口",width:"88%","before-close":i.clickClear,top:"0"},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{gutter:10},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{span:6},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{onTreeClick:i.handleTreeClick,handleTreeClick:i.handleTreeClick},null,8,["onTreeClick","handleTreeClick"])])),_:1}),(0,a.Wm)(r,{span:18},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{gutter:1,style:{"margin-bottom":"20px"}},{default:(0,a.w5)((()=>[(0,a._)("div",Oe,[(0,a.Wm)(p,{style:{width:"400px"},modelValue:n.filterText,"onUpdate:modelValue":t[0]||(t[0]=e=>n.filterText=e),placeholder:"请输入接口名称进行搜索",clearable:""},{append:(0,a.w5)((()=>[(0,a.Wm)(c,{type:"primary",onClick:i.handlenewInterfacesClick},{default:(0,a.w5)((()=>[(0,a.Uk)("查询")])),_:1},8,["onClick"])])),_:1},8,["modelValue"]),(0,a._)("div",null,[(0,a.Wm)(c,{type:"primary",style:{"margin-bottom":"20px","margin-top":"40px","margin-right":"10px"},onClick:i.userInterface,icon:"el-icon-view"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(i.buttonText),1)])),_:1},8,["onClick"]),(0,a.Wm)(c,{type:"primary",style:{"margin-bottom":"20px","margin-top":"40px","margin-right":"10px"},icon:"el-icon-star-off",onClick:t[1]||(t[1]=e=>n.dialogVisible=!0)},{default:(0,a.w5)((()=>[(0,a.Uk)("选择环境 ")])),_:1}),(0,a.Wm)(g,{modelValue:n.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>n.dialogVisible=e),width:"30%",title:"选择环境"},{footer:(0,a.w5)((()=>[(0,a._)("span",Ne,[(0,a.Wm)(c,{onClick:t[3]||(t[3]=e=>n.dialogVisible=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(c,{type:"primary",onClick:i.confirmSelection},{default:(0,a.w5)((()=>[(0,a.Uk)("确定")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(f,{rules:e.rulesinterface,ref:"interfaceRef"},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{label:"测试环境",prop:"env"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{modelValue:n.selectedEnvironment,"onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedEnvironment=e),modelModifiers:{lazy:!0},placeholder:"请选择环境",style:{width:"70%"},"no-data-text":"暂无数据"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.testEnvs,(e=>((0,a.wg)(),(0,a.j4)(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules"])])),_:1},8,["modelValue"]),(0,a._)("span",Pe,[(0,a.Uk)("当前环境： "),(0,a.Wm)(c,{type:"info",disabled:"",plain:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(n.selectedEnvironmentName),1)])),_:1})]),(0,a.Wm)(c,{type:"warning",style:{"margin-bottom":"20px","margin-top":"40px",float:"right"},onClick:i.clickClear,icon:"el-icon-close"},{default:(0,a.w5)((()=>[(0,a.Uk)("关闭窗口 ")])),_:1},8,["onClick"]),(0,a.Wm)(c,{type:"primary",style:{"margin-bottom":"20px","margin-top":"40px",float:"right","margin-right":"15px"},onClick:i.handleApiClick,icon:"el-icon-check"},{default:(0,a.w5)((()=>[(0,a.Uk)("确认选择 ")])),_:1},8,["onClick"])]),(0,a._)("div",Be,"全部接口共 ("+(0,o.zw)(n.interfaceCount)+") 个",1),(0,a.Wm)(b,{height:"calc(100vh)"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{"body-style":{width:"calc(100vh + 210px)"}},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(r,{span:24},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{ref:"multipleTable",data:n.tableData,"row-key":"ID","cell-style":{paddingTop:"4px",paddingBottom:"4px"},selectable:n.selectionConfig,onSelectionChange:i.handleSelectionChange},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{type:"selection"}),(0,a.Wm)(w,{align:"center"},{default:(0,a.w5)((e=>[(0,a.Wm)(k,{style:(0,o.j5)(i.getRowClassName(e.row.method))},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{span:20},{default:(0,a.w5)((()=>[(0,a._)("div",He,[(0,a._)("span",Ke,[(0,a._)("div",Le,["POST"===e.row.method?((0,a.wg)(),(0,a.iD)("span",Ye,[(0,a.Wm)(y,{color:"#49cc90",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"GET"===e.row.method?((0,a.wg)(),(0,a.iD)("span",Ze,[(0,a.Wm)(y,{color:"#61affe",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"PUT"===e.row.method?((0,a.wg)(),(0,a.iD)("span",Ge,[(0,a.Wm)(y,{color:"#fca130",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"PATCH"===e.row.method?((0,a.wg)(),(0,a.iD)("span",Je,[(0,a.Wm)(y,{color:"#50e3c2",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"DELETE"===e.row.method?((0,a.wg)(),(0,a.iD)("span",Qe,[(0,a.Wm)(y,{color:"#f93e3e",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0),"DEAD"===e.row.method?((0,a.wg)(),(0,a.iD)("span",Xe,[(0,a.Wm)(y,{color:"rgb(201, 233, 104)",size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.method),1)])),_:2},1024)])):(0,a.kq)("",!0)]),(0,a._)("b",et,(0,o.zw)(e.row.url),1),(0,a._)("span",tt,(0,o.zw)(e.row.name),1)])])])),_:2},1024),(0,a.Wm)(r,{span:4},{default:(0,a.w5)((()=>[(0,a._)("span",lt,[(0,a.Wm)(c,{type:"text",size:"small",class:"card-button",onClick:t=>i.clickEditStep(e.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)(" 调试 ")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"text",size:"small",class:"card-button",onClick:t=>i.clickCopy(e.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)(" 复制 ")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"text",size:"mini",onClick:t=>i.clickDel(e.row.id)},{default:(0,a.w5)((()=>[(0,a.Uk)(" 删除 ")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"text",size:"small",class:"card-button",onClick:i.clickLog},{default:(0,a.w5)((()=>[(0,a.Uk)(" 操作记录 ")])),_:1},8,["onClick"])])])),_:2},1024)])),_:2},1032,["style"])])),_:1})])),_:1},8,["data","selectable","onSelectionChange"])])),_:1})])),_:1})])),_:1},8,["body-style"])])),_:1})])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","before-close"]),(0,a.Wm)(I,{modelValue:n.editCaseDlg,"onUpdate:modelValue":t[6]||(t[6]=e=>n.editCaseDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{ref:"childRef",onCloseDrawer:i.handleClose,Interface_id:n.Interface_id,copyDlg:n.copyDlg,style:{padding:"0 10px"}},null,8,["onCloseDrawer","Interface_id","copyDlg"])])),_:1},8,["modelValue"]),(0,a.Wm)(I,{modelValue:n.logDlg,"onUpdate:modelValue":t[7]||(t[7]=e=>n.logDlg=e),"with-header":!1,size:"50%"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[at,(0,a._)("div",ot,[(0,a.Wm)(W,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.bugLogs,((t,l)=>((0,a.wg)(),(0,a.j4)(v,{key:l,timestamp:e.$tools.rDate(t.create_time),placement:"top",color:"#0bbd87"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[(0,a._)("h4",null,(0,o.zw)(t.handle),1),t.remark?((0,a.wg)(),(0,a.iD)("p",st,"变更记录："+(0,o.zw)(t.remark),1)):(0,a.kq)("",!0),(0,a._)("span",nt,(0,o.zw)(t.update_user),1),(0,a._)("span",null,"操作于 "+(0,o.zw)(e.$tools.rTime(t.create_time)),1)])),_:2},1024)])),_:2},1032,["timestamp"])))),128))])),_:1})])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(g,{modelValue:n.importDlg,"onUpdate:modelValue":t[9]||(t[9]=e=>n.importDlg=e),width:"30%",title:"导入接口"},{footer:(0,a.w5)((()=>[(0,a._)("span",it,[(0,a.Wm)(c,{onClick:t[8]||(t[8]=e=>n.importDlg=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(c,{type:"primary",onClick:e.confirmSelection1},{default:(0,a.w5)((()=>[(0,a.Uk)("导入")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(f,{rules:e.rulesinterface,ref:"interfaceRef"},null,8,["rules"])])),_:1},8,["modelValue"])],64)}var rt=l(71955),ct=l(74024),pt={components:{treeNode:rt.Z,newEditCase:ct.Z},computed:{buttonText(){return this.showOnlySelf?"取消只看自己创建":"只看自己创建"},...(0,je.rn)(["pro","testEnvs","envId"]),username(){return window.sessionStorage.getItem("username")},env:{get(){return this.envId},set(e){this.selectEnv(e)}}},data(){return{addApiDlg:!0,treeId:"",filterText:"",tableData:[],editCaseDlg:!1,logDlg:!1,importDlg:!1,Interface_id:"",copyDlg:!1,showOnlySelf:!1,selectedOption:"",dialogVisible:!1,selectedEnvironment:"",selectedEnvironmentName:"暂未选择",selectionConfig:{selectedRowKeys:[],selectionChange:this.handleSelectionChange},bugLogs:[{create_time:"2024-02-18T10:30:00",handle:"修复了一个bug",remark:"这是修复bug的备注",update_user:"张三"},{create_time:"2024-02-17T14:20:00",handle:"重新测试了bug",remark:"接口名称登录变更为tms登录接口",update_user:"李四"},{create_time:"2024-02-16T09:45:00",handle:"提交了一个新的bug",update_user:"王五"}],interfaceCount:0}},methods:{...(0,je.OI)(["selectEnv"]),closeModal(){this.$emit("close-modal")},clickClear(){this.closeModal()},handleSelectionChange(e){this.selectionConfig.selectedRowKeys=e.map((e=>e.id))},getRowClassName(e){switch(e){case"GET":return"--el-card-border-color:#61affe;background-color:rgba(97,175,254,.1)";case"POST":return"--el-card-border-color:#49cc90;background-color:rgba(73,204,144,.1)";case"PUT":return"--el-card-border-color:#fca130;background-color:rgba(252,161,48,.1)";case"DELETE":return"--el-card-border-color:#f93e3e;background-color:rgba(249,62,62,.1)";case"PATCH":return"--el-card-border-color:#50e3c2;background-color:rgba(80,227,194,.1)";default:return""}},async handleTreeClick(e,t,l){if(t){const l=await this.$api.getnewInterfaces(e,t);200===l.status&&(this.treeId=e,this.tableData=l.data,this.interfaceCount=l.data.length)}else if(l){const a=await this.$api.getnewInterfaces(e,t,l);200===a.status&&(this.treeId=e,this.tableData=a.data,this.interfaceCount=a.data.length)}else{const t=await this.$api.getnewInterfaces(e);200===t.status&&(this.treeId=e,this.tableData=t.data,this.interfaceCount=t.data.length)}},async delInterface(e){const t=await this.$api.delnewInterface(e);204===t.status&&((0,Me.z8)({type:"success",message:"删除成功",duration:1e3}),this.handleTreeClick(this.treeId),this.filterText="",this.$refs.multipleTable.clearSelection())},handleApiClick(){if(0===this.selectionConfig.selectedRowKeys.length)return void(0,Me.z8)({type:"warning",message:"请勾选数据后再操作！",duration:2e3});const e=[...this.selectionConfig.selectedRowKeys];this.$emit("childEvent",e),this.filterText="",this.selectionConfig.selectedRowKeys=[],this.$refs.multipleTable.clearSelection(),this.clickClear()},handlenewInterfacesClick(){this.handleTreeClick(this.treeId,this.filterText)},clickDel(e){Me.T$.confirm("确定要删除该接口吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.delInterface(e)})).catch((()=>{(0,Me.z8)({type:"info",message:"取消删除",duration:1e3})}))},handleClose(){this.addCaseDlg=!1,this.editCaseDlg=!1,this.copyDlg=!1,this.handleTreeClick(this.treeId)},clickEditStep(e){this.Interface_id=e,this.editCaseDlg=!0,this.$nextTick((()=>{this.$refs.childRef.getInterfaceInfo(this.Interface_id)}))},clickCopy(e){this.copyDlg=!0,this.clickEditStep(e)},clickLog(){this.logDlg=!0},userInterface(){this.showOnlySelf=!this.showOnlySelf,this.showOnlySelf?this.handleTreeClick(this.treeId,"",this.username):this.handleTreeClick(this.treeId)},confirmSelection(){this.env=this.selectedEnvironment,this.selectedEnvironmentName=this.testEnvs.find((e=>e.id===this.selectedEnvironment)).name,this.dialogVisible=!1}}},ut=l(40089);const mt=(0,ut.Z)(pt,[["render",dt],["__scopeId","data-v-2811cd9e"]]);var ht=mt,ft=l(81578),gt=l(62669),wt={components:{apiCite:ht,newEditCase:ct.Z,caseResult:ft.Z,Editor:gt.Z},data(){return{editForm:{name:"",project_id:"",desc:"",stepCount:0,creator:""},rulesCase:{name:[{required:!0,message:"请输入用例名称",trigger:"blur"}],project_id:[{required:!0,message:"请选择项目",trigger:"blur"}]},steps:[],addApiDlg:!1,editCaseDlg:!1,Interface_id:"",copyDlg:!1,ResultDlg:!1,runScentResult:"",ControllerData:{name:"",type:"",content:{},script:"",desc:"",creator:""},options:[{value:"equal",label:"等于"},{value:"notEqual",label:"不等于"},{value:"contains",label:"包含"},{value:"notContains",label:"不包含"},{value:"greaterThan",label:"大于"},{value:"lessThan",label:"小于"},{value:"greaterThanOrEqual",label:"大于等于"},{value:"lessThanOrEqual",label:"小于等于"},{value:"empty",label:"空"},{value:"notEmpty",label:"非空"}],test:"",treeKey:"",isExpand:!1}},computed:{...(0,je.rn)(["pro","case","envId","testEnvs"]),testEnvsWithDefault(){const e=[...this.testEnvs];return e.unshift({host:"默认环境host",name:"默认环境"}),e},username(){return window.sessionStorage.getItem("username")},defaultProps(){return{children:"children",label:"name"}}},watch:{steps:{deep:!0}},methods:{...(0,je.OI)(["CaseInfo","clearCaseInfo"]),getCardIndex(e,t){const l=e.childNodes.indexOf(t);return l+1},async addCaseSave(){this.$refs.CaseRef.validate((async e=>{if(!e)return;const t={...this.editForm};t.creator=this.username,t.project_id=this.pro.id;const l=await this.$api.createTestCase(t);201===l.status&&(0,Me.z8)({type:"success",message:"保存成功",duration:1e3})}))},async editCaseSave(){this.$refs.CaseRef.validate((async e=>{if(!e)return;const t={...this.editForm};t.project_id=this.pro.id,t.modifier=this.username,t.update_time=this.$tools.newTime(),delete t.create_time,delete t.creator,delete t.project;const l=await this.$api.updateTestCase(t.id,t);200===l.status&&((0,Me.z8)({type:"success",message:"保存成功",duration:1e3}),this.editStepSave())}))},async editStepSave(){const e=this.steps.filter((e=>e.stepInfo&&"api"!==e.stepInfo.type)).map((e=>e)),t=await this.$api.updatesStepControll(e);201===t.status&&this.getCaseStep(this.case.id)},reaiTime(){this.case?(this.editForm=this.case,this.editForm.project_id=this.pro.name):this.editForm.project_id=this.pro.name},goBack(){this.case&&this.case.back_type?(this.$router.push({name:"new-testplan"}),this.clearCaseInfo()):(this.$router.push({name:"TestCase"}),this.clearCaseInfo())},handleStepClick(e){"api"===e.stepInfo.type?(this.Interface_id=e.interfaceStep,this.editCaseDlg=!0,this.$nextTick((()=>{this.$refs.childRef.getInterfaceInfo(this.Interface_id)}))):("script"===e.stepInfo.type||"sql"===e.stepInfo.type)&&(e.stepInfo.dlg=!e.stepInfo.dlg)},handleClose(){this.addCaseDlg=!1,this.editCaseDlg=!1},getRowClassName(e){switch(e){case"api":return"--el-card-border-color:rgb(97, 100, 159);";case"if":return"--el-card-border-color:rgb(230, 162, 60);";case"for":return"--el-card-border-color:rgb(2, 167, 240);";case"script":return"--el-card-border-color:rgb(123, 77, 18);";case"time":return"--el-card-border-color:rgb(103, 194, 58);";case"sql":return"--el-card-border-color:rgb(120, 56, 135);";default:return""}},allowDrop(e,t,l){const a=["for","if"];return!!a.includes(t.data.stepInfo.type)||("prev"===l||"next"===l)},async copyTree(e,t=null,l=!0){event.stopPropagation();let a=this.steps.length>0?this.steps.length+1:1;if("api"===e.stepInfo.type)await this.$api.createTestCaseStep({case:this.case.id,interfaceStep:e.interfaceStep,sort:a,parent_id:t});else{e.stepInfo.case=this.case.id,e.stepInfo.sort=a,e.stepInfo.parent_id=t;const o=await this.$api.copyStepControll(e.stepInfo),s=o.data.setpId;if(e.children){let t=e.children.map(((t,a)=>{const o=l&&a===e.children.length-1;return this.copyTree(t,s,o)}));await Promise.all(t)}}l&&this.getCaseStep(this.case.id)},async delTree(e){if(event.stopPropagation(),"api"===e.stepInfo.type){const t=await this.$api.delTestCaseStep(e.id);204===t.status&&this.getCaseStep(this.case.id)}else{const t=await this.$api.delTestCaseStep(e.id);if(204===t.status){const t=await this.$api.delStepControll(e.controllerStep);204===t.status&&this.getCaseStep(this.case.id)}}},showApiCite(){this.$refs.CaseRef.validate((async e=>{e&&(this.addApiDlg=!0)}))},handleCloseModal(){this.addApiDlg=!1},async handleChildData(e){let t=this.steps.length>0?this.steps.length+1:1,l=[];e.forEach((e=>{let a={sort:t,case:this.case.id,interfaceStep:e};l.push(a),t++}));const a=await this.$api.createsTestCaseStep(l);201===a.status&&this.getCaseStep(this.case.id)},async getCaseStep(e){const t=await this.$api.getTestCaseStep(e);200===t.status&&(this.steps=t.data,this.editForm.stepCount=this.steps.length)},async switchClick(){event.stopPropagation(),this.updateStepOrder()},async updateStepOrder(){const e=(t,l,a)=>{t.sort=a,t.children&&t.children.length>0&&t.children.forEach(((l,a)=>{l.parent_id=t.id,l.sort=a+1,e(l,t.id,l.sort)}))};this.steps.forEach(((t,l)=>{t.sort=l+1,t.children&&t.children.length>0&&e(t,t.id,t.sort)}));const t=await this.$api.updateCaseStepOrder(this.steps);200===t.status&&(0,Me.bM)({duration:500,title:"调整成功",type:"success"})},async runCase(){if(this.envId){const e={env:this.envId,scene:this.case.id};(0,Me.bM)({title:"开始运行",message:"运行过程中请稍等片刻噢",type:"success",duration:1e3});const t=await this.$api.runCases(this.case.id,e);200==t.status&&(this.runScentResult=t.data,this.ResultDlg=!0)}else this.$message({type:"warning",message:"当前未选中执行环境!",duration:1e3})},toggleExpand(e){e.dlg=!e.dlg},startEditing(e){e.type,e.inputDlg=!0,this.$nextTick((()=>{this.$refs.input.focus()}))},cancelEditing(e){e.inputDlg=!1},addSetUptCodeMod(e,t){switch(t){case"ENV":e.script+='\n# 设置全局变量 \nBaseTest().save_global_variable("变量名","变量值")';break;case"env":e.script+='\n# 设置局部变量  \nBaseTest().save_env_variable("变量名","变量值")';break;case"func":e.script+="\nfrom apitestengine.core.cases import BaseTest";break;case"sql":e.script+='\n# ----执行sql语句(需要在环境中配置数据库连接信息)----\n# db.连接名.execute_all(sql语句) \nsql = "SELECT count(*) as count FROM futureloan.member"\nres = db.aliyun.execute_all(sql)';break}},handleDragScroll(){document.addEventListener("mousemove",(function(e){const t=e.clientY,l=document.querySelector(".el-tree").getBoundingClientRect().top;t<100&&l>0?window.scrollBy(0,-10):t>window.innerHeight-100&&window.scrollBy(0,10)}))},async AddController(e){let t=this.steps.length>0?this.steps.length+1:1;if("if"===e)this.ControllerData={name:"条件控制器",type:"if",content:{variable:"",JudgmentMode:"",value:""},script:"",desc:"",creator:this.username};else if("for"===e)this.ControllerData={name:"循环控制器",type:"for",content:{select:"count",cycleIndex:"",cycleInterval:"",variable:"",variableName:""},script:"",desc:"",creator:this.username};else if("script"===e)this.ControllerData={name:"自定义脚本",type:"script",content:{},script:"",desc:"",creator:this.username};else if("time"===e)this.ControllerData={name:"定时控制器",type:"time",content:{time:""},script:"",desc:"",creator:this.username};else{if("sql"!==e)throw new Error("types is not defined");this.ControllerData={name:"数据库操作",type:"sql",content:{},script:"",desc:"",creator:this.username}}const l=await this.$api.createStepControll(this.ControllerData);if(201===l.status){const e=await this.$api.createTestCaseStep({case:this.case.id,controllerStep:l.data.id,sort:t});201===e.status&&this.getCaseStep(this.case.id)}},rowOpenORFold(e){this.treeKey=+new Date,this.isExpand=e},async envClick(e,t){let l;l="默认环境"===e.name?{host:{}}:{host:{host:e.host,name:e.name}};const a=await this.$api.updatenewInterface(t.id,l);200===a.status&&(0,Me.z8)({type:"success",message:"变更成功",duration:1e3}),this.getCaseStep(this.case.id)}},created(){this.reaiTime(),this.case&&this.case.id&&this.getCaseStep(this.case.id)}};const yt=(0,ut.Z)(wt,[["render",Fe],["__scopeId","data-v-a9ac6be4"]]);var kt=yt}}]);
//# sourceMappingURL=991.4dda65bd.js.map