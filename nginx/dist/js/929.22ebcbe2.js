"use strict";(self["webpackChunkfrontend_web"]=self["webpackChunkfrontend_web"]||[]).push([[929],{1230:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var vuex__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20065);__webpack_exports__.Z={data(){return{hookList:"",pages:"",addDlg:!1,isLoading:!1,editDlg:!1,addForm:{name:"",webhook:"",user_ids:[],project_id:"",testPlan_id:""},editForm:{name:"",webhook:"",user_ids:[],project_id:"",testPlan_id:""},rulesHook:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],webhook:[{required:!0,message:"请输入webhook地址",trigger:"blur"}],testPlan_id:[{required:!0,message:"请选择测试计划",trigger:"blur"}]}}},computed:{...(0,vuex__WEBPACK_IMPORTED_MODULE_0__.rn)(["pro","testPlans","Users"]),filteredUsers(){const e=this.Users.filter((e=>null!==e.weChat_name));return e}},methods:{...(0,vuex__WEBPACK_IMPORTED_MODULE_0__.nv)(["getAllUser"]),clickAdd(){this.addDlg=!0,this.addForm={name:"",webhook:"",user_ids:[],project_id:this.pro.id,testPlan_id:""}},clickEdit(e){this.editDlg=!0,this.editForm={...e},this.editForm.project_id=this.pro.id,console.log(this.editForm)},delHook(e){this.$confirm("此操作将永久删除该推送信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const l=await this.$api.delHook(e);204===l.status&&(this.$message({type:"success",message:"删除成功!"}),this.getAllHook(this.pro))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},clearValidation(){this.addDlg=!1,this.editDlg=!1,this.$refs.HookRef.clearValidate()},async getAllHook(){this.isLoading=!0;const response=await this.$api.getHook(this.pro.id);200===response.status&&(this.hookList=response.data.result,this.pages=response.data,this.hookList.forEach((record=>{const userIDs=eval(record.user_ids);record.user_ids=userIDs})),console.log(this.hookList)),this.isLoading=!1},async AddInter(){this.$refs.HookRef.validate((async e=>{if(!e)return;const l={...this.addForm},t=l.user_ids.map((e=>`'${e}'`));l.user_ids=`[${t.join(",")}]`;const a=await this.$api.createHook(l);201===a.status&&(this.$message({type:"success",message:"添加成功",duration:1e3}),this.addForm={name:"",webhook:"",user_ids:[],project_id:"",testPlan_id:""},this.addDlg=!1,this.getAllHook())}))},async EditInter(){this.$refs.HookRef.validate((async e=>{if(!e)return;const l={...this.editForm},t=l.user_ids.map((e=>`'${e}'`));l.user_ids=`[${t.join(",")}]`;const a=await this.$api.updateHook(l.id,l);200===a.status&&(this.$message({type:"success",message:"修改成功",duration:1e3}),this.editForm={name:"",webhook:"",user_ids:[],project_id:"",testPlan_id:""},this.editDlg=!1,this.getAllHook())}))},currentPages(e){this.getAllHook(e),this.hookList.page=e}},created(){this.getAllHook(),this.getAllUser()}}},64929:function(e,l,t){t.r(l),t.d(l,{default:function(){return p}});var a=t(73396),o=t(87139);const i={class:"table_data"},d={class:"pagination-container"},s={class:"dialog-footer"},r={class:"dialog-footer"};function n(e,l,t,n,u,m){const c=(0,a.up)("el-button"),p=(0,a.up)("el-table-column"),_=(0,a.up)("el-tooltip"),h=(0,a.up)("el-table"),w=(0,a.up)("el-pagination"),g=(0,a.up)("el-scrollbar"),k=(0,a.up)("el-input"),b=(0,a.up)("el-form-item"),f=(0,a.up)("el-option"),W=(0,a.up)("el-select"),V=(0,a.up)("el-form"),y=(0,a.up)("el-dialog"),F=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(c,{onClick:m.clickAdd,type:"success",icon:"el-icon-plus",style:{"margin-bottom":"30px","margin-left":"20px","margin-top":"25px"}},{default:(0,a.w5)((()=>[(0,a.Uk)("新增推送信息")])),_:1},8,["onClick"]),(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{data:u.hookList,stripe:"",style:{width:"100%"},"empty-text":"暂无数据"},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{label:"序号",align:"center",width:"60"},{default:(0,a.w5)((e=>[(0,a._)("span",null,(0,o.zw)(e.$index+1),1)])),_:1}),(0,a.Wm)(p,{label:"推送名称",prop:"name",align:"center"}),(0,a.Wm)(p,{label:"hook地址",prop:"webhook",align:"center"},{default:(0,a.w5)((e=>[(0,a.Wm)(_,{placement:"top-start",effect:"dark",content:e.row.webhook},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,o.zw)(e.row.webhook.length>30?e.row.webhook.slice(0,30)+"...":e.row.webhook),1)])),_:2},1032,["content"])])),_:1}),(0,a.Wm)(p,{label:"接收人",prop:"user_ids",align:"center"}),(0,a.Wm)(p,{label:"测试计划",prop:"testPlan.name",align:"center"}),(0,a.Wm)(p,{label:"创建时间",align:"center"},{default:(0,a.w5)((l=>[(0,a.Uk)((0,o.zw)(e.$tools.rTime(l.row.create_time)),1)])),_:1}),(0,a.Wm)(p,{label:"操作",width:"180",align:"center"},{default:(0,a.w5)((e=>[(0,a.Wm)(c,{onClick:l=>m.clickEdit(e.row),size:"mini",plain:"",type:"success",icon:"el-icon-edit-outline"},{default:(0,a.w5)((()=>[(0,a.Uk)("编辑")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{onClick:l=>m.delHook(e.row.id),size:"mini",type:"danger",plain:"",icon:"el-icon-delete"},{default:(0,a.w5)((()=>[(0,a.Uk)("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[F,u.isLoading]])]),(0,a._)("div",d,[(0,a.Wm)(w,{background:"",layout:"total, prev, pager, next, jumper",onCurrentChange:m.currentPages,"default-page-size":"100",total:u.pages.count,"current-page":u.pages.current,"next-text":"下一页","prev-text":"上一页"},null,8,["onCurrentChange","total","current-page"])])])),_:1}),(0,a.Wm)(y,{modelValue:u.addDlg,"onUpdate:modelValue":l[4]||(l[4]=e=>u.addDlg=e),title:"新增推送信息",width:"37%","custom-class":"class_dialog",required:!0,style:{"text-align":"left"},"before-close":m.clearValidation},{footer:(0,a.w5)((()=>[(0,a._)("span",s,[(0,a.Wm)(c,{onClick:m.clearValidation,size:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1},8,["onClick"]),(0,a.Wm)(c,{type:"success",onClick:m.AddInter,size:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("确定")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(V,{model:u.addForm,rules:u.rulesHook,ref:"HookRef","label-width":"120px",style:{"max-width":"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{prop:"name",label:"推送名称"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{modelValue:u.addForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>u.addForm.name=e),maxlength:"50",minlength:"1",placeholder:"请输入推送名称"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(b,{prop:"webhook",label:"webhook地址"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{modelValue:u.addForm.webhook,"onUpdate:modelValue":l[1]||(l[1]=e=>u.addForm.webhook=e),minlength:"3",placeholder:"请输入webhook地址","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(b,{prop:"testPlan_id",label:"测试计划"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:u.addForm.testPlan_id,"onUpdate:modelValue":l[2]||(l[2]=e=>u.addForm.testPlan_id=e),placeholder:"请选择测试计划",style:{width:"100%"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.testPlans,(e=>((0,a.wg)(),(0,a.j4)(f,{label:e.name,value:e.id,key:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(b,{label:"接收人"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{multiple:"",modelValue:u.addForm.user_ids,"onUpdate:modelValue":l[3]||(l[3]=e=>u.addForm.user_ids=e),placeholder:"请选择接收人",style:{width:"100%"}},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.j4)(f,{label:"@all",value:"@all",key:"@all"})),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(m.filteredUsers,(e=>((0,a.wg)(),(0,a.j4)(f,{label:e.weChat_name,value:e.weChat_name,key:e.id,disabled:u.editForm.user_ids.includes("@all")},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","before-close"]),(0,a.Wm)(y,{modelValue:u.editDlg,"onUpdate:modelValue":l[9]||(l[9]=e=>u.editDlg=e),title:"修改推送信息",width:"37%","custom-class":"class_dialog",required:!0,style:{"text-align":"left"},"before-close":m.clearValidation},{footer:(0,a.w5)((()=>[(0,a._)("span",r,[(0,a.Wm)(c,{onClick:m.clearValidation,size:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1},8,["onClick"]),(0,a.Wm)(c,{type:"success",onClick:m.EditInter,size:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("确定")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(V,{model:u.editForm,rules:u.rulesHook,ref:"HookRef","label-width":"120px",style:{"max-width":"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{prop:"name",label:"推送名称"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{modelValue:u.editForm.name,"onUpdate:modelValue":l[5]||(l[5]=e=>u.editForm.name=e),maxlength:"50",minlength:"1",placeholder:"请输入推送名称"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(b,{prop:"webhook",label:"webhook地址"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{modelValue:u.editForm.webhook,"onUpdate:modelValue":l[6]||(l[6]=e=>u.editForm.webhook=e),minlength:"3",placeholder:"请输入webhook地址","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(b,{prop:"testPlan_id",label:"测试计划"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:u.editForm.testPlan_id,"onUpdate:modelValue":l[7]||(l[7]=e=>u.editForm.testPlan_id=e),placeholder:"请选择测试计划",style:{width:"100%"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.testPlans,(e=>((0,a.wg)(),(0,a.j4)(f,{label:e.name,value:e.id,key:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(b,{label:"接收人"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{multiple:"",modelValue:u.editForm.user_ids,"onUpdate:modelValue":l[8]||(l[8]=e=>u.editForm.user_ids=e),placeholder:"请选择接收人",style:{width:"100%"}},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.j4)(f,{label:"@all",value:"@all",key:"@all"})),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(m.filteredUsers,(e=>((0,a.wg)(),(0,a.j4)(f,{label:e.weChat_name,value:e.weChat_name,key:e.id,disabled:u.editForm.user_ids.includes("@all")},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","before-close"])],64)}var u=t(1230),m=t(40089);const c=(0,m.Z)(u.Z,[["render",n],["__scopeId","data-v-58f111e0"]]);var p=c}}]);
//# sourceMappingURL=929.22ebcbe2.js.map