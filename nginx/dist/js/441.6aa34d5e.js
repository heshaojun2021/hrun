"use strict";(self["webpackChunkfrontend_web"]=self["webpackChunkfrontend_web"]||[]).push([[441],{75441:function(e,a,t){t.d(a,{Z:function(){return $}});var s=t(73396);const n=e=>((0,s.dD)("data-v-a4fce516"),e=e(),(0,s.Cn)(),e),l=n((()=>(0,s._)("b",null,"Api信息",-1))),o={key:0,class:"case_info"},i=n((()=>(0,s._)("b",null,"用例信息",-1))),d=n((()=>(0,s._)("b",null,"请求信息",-1))),c={key:0},r={key:1},u={key:2},p={class:"code_mod"},m={class:"code_mod"},f={class:"code_mod"},_={class:"code_mod"},h={class:"code_mod"},w={class:"code_mod"},k={class:"code_mod"},y={class:"code_mod"},g={class:"code_mod"},b={class:"code_mod"},W={class:"code_mod"},I={class:"code_mod"},v={class:"code_mod"},C={class:"code_mod"},T={key:1},U=n((()=>(0,s._)("b",null,"执行结果",-1))),x=n((()=>(0,s._)("div",{style:{height:"20px"}},null,-1)));function D(e,a,t,n,D,V){const q=(0,s.up)("el-divider"),j=(0,s.up)("el-option"),S=(0,s.up)("el-select"),E=(0,s.up)("el-input"),z=(0,s.up)("el-col"),M=(0,s.up)("el-button"),O=(0,s.up)("el-row"),$=(0,s.up)("Editor"),N=(0,s.up)("el-tab-pane"),P=(0,s.up)("el-radio"),R=(0,s.up)("el-radio-group"),J=(0,s.up)("FromData"),A=(0,s.up)("el-scrollbar"),B=(0,s.up)("el-tabs"),H=(0,s.up)("caseResult");return(0,s.wg)(),(0,s.j4)(A,{height:"calc(100vh - 60px);padding-right:30px;"},{default:(0,s.w5)((()=>[(0,s.Wm)(q,{"content-position":"left"},{default:(0,s.w5)((()=>[l])),_:1}),(0,s.Wm)(O,{gutter:10},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{span:18},{default:(0,s.w5)((()=>[(0,s.Wm)(E,{modelValue:D.caseInfo.interface.url,"onUpdate:modelValue":a[1]||(a[1]=e=>D.caseInfo.interface.url=e),placeholder:"接口地址"},{prepend:(0,s.w5)((()=>[(0,s.Wm)(S,{modelValue:D.caseInfo.interface.method,"onUpdate:modelValue":a[0]||(a[0]=e=>D.caseInfo.interface.method=e),placeholder:"请求方法",size:"small",style:{width:"100px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{label:"GET",value:"GET"}),(0,s.Wm)(j,{label:"POST",value:"POST"}),(0,s.Wm)(j,{label:"PUT",value:"PUT"}),(0,s.Wm)(j,{label:"PATCH",value:"PATCH"}),(0,s.Wm)(j,{label:"DELETE",value:"DELETE"}),(0,s.Wm)(j,{label:"OPTION",value:"OPTION"}),(0,s.Wm)(j,{label:"HEAD",value:"HEAD"})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),(0,s.Wm)(z,{span:6,style:{"text-align":"right"}},{default:(0,s.w5)((()=>[(0,s.Wm)(M,{onClick:V.runCase,type:"success",icon:"el-icon-s-promotion"},{default:(0,s.w5)((()=>[(0,s.Uk)("发送")])),_:1},8,["onClick"])])),_:1})])),_:1}),D.caseInfo.id?((0,s.wg)(),(0,s.iD)("div",o,[(0,s.Wm)(q,{"content-position":"left"},{default:(0,s.w5)((()=>[i])),_:1}),(0,s.Wm)(O,null,{default:(0,s.w5)((()=>[(0,s.Wm)(z,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(E,{modelValue:D.caseInfo.title,"onUpdate:modelValue":a[2]||(a[2]=e=>D.caseInfo.title=e),placeholder:"用例名"},{prepend:(0,s.w5)((()=>[(0,s.Uk)(" 用例名称 ")])),_:1},8,["modelValue"])])),_:1}),(0,s.Wm)(z,{span:12,style:{"text-align":"right"}},{default:(0,s.w5)((()=>["/testStep"===e.$route.path?((0,s.wg)(),(0,s.j4)(M,{key:0,onClick:V.deleteCase,type:"danger",icon:"el-icon-delete",plain:""},{default:(0,s.w5)((()=>[(0,s.Uk)("删除")])),_:1},8,["onClick"])):(0,s.kq)("",!0),"/testStep"===e.$route.path?((0,s.wg)(),(0,s.j4)(M,{key:1,onClick:V.copyCase,type:"success",icon:"el-icon-document-copy",plain:""},{default:(0,s.w5)((()=>[(0,s.Uk)("复制")])),_:1},8,["onClick"])):(0,s.kq)("",!0),(0,s.Wm)(M,{onClick:V.saveCase,type:"success",icon:"el-icon-s-claim",plain:""},{default:(0,s.w5)((()=>[(0,s.Uk)("保存")])),_:1},8,["onClick"])])),_:1})])),_:1})])):(0,s.kq)("",!0),(0,s.Wm)(q,{"content-position":"left"},{default:(0,s.w5)((()=>[d])),_:1}),(0,s.Wm)(B,{type:"border-card",style:{"min-height":"370px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{label:"请求头(headers)"},{default:(0,s.w5)((()=>[(0,s.Wm)($,{modelValue:D.headers,"onUpdate:modelValue":a[3]||(a[3]=e=>D.headers=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(N,{label:"查询参数(Params)"},{default:(0,s.w5)((()=>[(0,s.Wm)($,{modelValue:D.params,"onUpdate:modelValue":a[4]||(a[4]=e=>D.params=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(N,{label:"请求体(Body)"},{default:(0,s.w5)((()=>[(0,s.Wm)(R,{modelValue:D.paramType,"onUpdate:modelValue":a[5]||(a[5]=e=>D.paramType=e),style:{"margin-bottom":"5px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(P,{label:"json"},{default:(0,s.w5)((()=>[(0,s.Uk)("application/json")])),_:1}),(0,s.Wm)(P,{label:"data"},{default:(0,s.w5)((()=>[(0,s.Uk)("x-www-form-urlencoded")])),_:1}),(0,s.Wm)(P,{label:"formData"},{default:(0,s.w5)((()=>[(0,s.Uk)("form-data")])),_:1})])),_:1},8,["modelValue"]),"json"===D.paramType?((0,s.wg)(),(0,s.iD)("div",c,[(0,s.Wm)($,{modelValue:D.json,"onUpdate:modelValue":a[6]||(a[6]=e=>D.json=e)},null,8,["modelValue"])])):"data"===D.paramType?((0,s.wg)(),(0,s.iD)("div",r,[(0,s.Wm)($,{modelValue:D.data,"onUpdate:modelValue":a[7]||(a[7]=e=>D.data=e)},null,8,["modelValue"])])):"formData"===D.paramType?((0,s.wg)(),(0,s.iD)("div",u,[(0,s.Wm)(J,{modelValue:D.file,"onUpdate:modelValue":a[8]||(a[8]=e=>D.file=e)},null,8,["modelValue"])])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(N,{label:"前置脚本"},{default:(0,s.w5)((()=>[(0,s.Wm)(O,{gutter:10},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{span:18},{default:(0,s.w5)((()=>[(0,s.Wm)($,{modelValue:D.caseInfo.setup_script,"onUpdate:modelValue":a[9]||(a[9]=e=>D.caseInfo.setup_script=e),lang:"python",theme:"monokai"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(z,{span:6},{default:(0,s.w5)((()=>[(0,s.Wm)(q,null,{default:(0,s.w5)((()=>[(0,s.Uk)("脚本模板")])),_:1}),(0,s._)("div",p,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[10]||(a[10]=e=>V.addSetUptCodeMod("ENV"))},{default:(0,s.w5)((()=>[(0,s.Uk)("预设全局变量")])),_:1})]),(0,s._)("div",m,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[11]||(a[11]=e=>V.addSetUptCodeMod("env"))},{default:(0,s.w5)((()=>[(0,s.Uk)("预设局部变量")])),_:1})]),(0,s._)("div",f,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[12]||(a[12]=e=>V.addSetUptCodeMod("func"))},{default:(0,s.w5)((()=>[(0,s.Uk)("调用全局函数")])),_:1})]),(0,s._)("div",_,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[13]||(a[13]=e=>V.addSetUptCodeMod("sql"))},{default:(0,s.w5)((()=>[(0,s.Uk)("执行sql查询")])),_:1})])])),_:1})])),_:1})])),_:1}),(0,s.Wm)(N,{label:"后置脚本"},{default:(0,s.w5)((()=>[(0,s.Wm)(O,{gutter:10},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{span:18},{default:(0,s.w5)((()=>[(0,s.Wm)($,{modelValue:D.caseInfo.teardown_script,"onUpdate:modelValue":a[14]||(a[14]=e=>D.caseInfo.teardown_script=e),lang:"python",theme:"monokai"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(z,{span:6},{default:(0,s.w5)((()=>[(0,s.Wm)(q,null,{default:(0,s.w5)((()=>[(0,s.Uk)("脚本模板")])),_:1}),(0,s.Wm)(A,{height:"250px"},{default:(0,s.w5)((()=>[(0,s._)("div",h,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[15]||(a[15]=e=>V.addTearDownCodeMod("getBody"))},{default:(0,s.w5)((()=>[(0,s.Uk)("获取响应体")])),_:1})]),(0,s._)("div",w,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[16]||(a[16]=e=>V.addTearDownCodeMod("JSextract"))},{default:(0,s.w5)((()=>[(0,s.Uk)("jsonpath提取数据")])),_:1})]),(0,s._)("div",k,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[17]||(a[17]=e=>V.addTearDownCodeMod("REextract"))},{default:(0,s.w5)((()=>[(0,s.Uk)("正则提取数据")])),_:1})]),(0,s._)("div",y,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[18]||(a[18]=e=>V.addTearDownCodeMod("ENV"))},{default:(0,s.w5)((()=>[(0,s.Uk)("设置全局变量")])),_:1})]),(0,s._)("div",g,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[19]||(a[19]=e=>V.addTearDownCodeMod("env"))},{default:(0,s.w5)((()=>[(0,s.Uk)("设置局部变量")])),_:1})]),(0,s._)("div",b,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[20]||(a[20]=e=>V.addTearDownCodeMod("func"))},{default:(0,s.w5)((()=>[(0,s.Uk)("调用全局函数")])),_:1})]),(0,s._)("div",W,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[21]||(a[21]=e=>V.addTearDownCodeMod("sql"))},{default:(0,s.w5)((()=>[(0,s.Uk)("执行sql查询")])),_:1})]),(0,s._)("div",I,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[22]||(a[22]=e=>V.addTearDownCodeMod("http"))},{default:(0,s.w5)((()=>[(0,s.Uk)("断言HTTP状态码")])),_:1})]),(0,s._)("div",v,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[23]||(a[23]=e=>V.addTearDownCodeMod("eq"))},{default:(0,s.w5)((()=>[(0,s.Uk)("断言相对")])),_:1})]),(0,s._)("div",C,[(0,s.Wm)(M,{type:"success",size:"mini",plain:"",onClick:a[24]||(a[24]=e=>V.addTearDownCodeMod("contain"))},{default:(0,s.w5)((()=>[(0,s.Uk)("断言包含")])),_:1})])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),D.runResult?((0,s.wg)(),(0,s.iD)("div",T,[(0,s.Wm)(q,{"content-position":"left"},{default:(0,s.w5)((()=>[U])),_:1}),(0,s.Wm)(H,{result:D.runResult},null,8,["result"])])):(0,s.kq)("",!0),x])),_:1})}var V=t(20065),q=t(62669),j=t(81578),S=t(93541),E=t(37046),z={components:{Editor:q.Z,caseResult:j.Z,FromData:S.Z},data(){return{caseInfo:{interface:{method:"POST",url:""},title:"接口用例",headers:{},request:{json:{pwd:"xxxxx",mobile_phone:"xxxxxxxx"}},file:[],setup_script:"",teardown_script:""},paramType:"json",json:"{}",data:"{}",params:"{}",headers:"{}",interfaceparams:"{}",file:[],runResult:null}},computed:{...(0,V.rn)(["interfaces","envId"])},props:["step"],methods:{...(0,V.nv)(["getAllInter"]),deleteCase(){E.T$.confirm("确定要删除该用例吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await this.$api.delTeststep(this.caseInfo.id);204===e.status&&((0,E.z8)({type:"success",message:"删除成功",duration:1e3}),this.getAllInter())})).catch((()=>{(0,E.z8)({type:"info",message:"取消删除",duration:1e3})}))},async saveCase(){const e=this.getEditData(),a=this.getInerfaceData(),t=await this.$api.updateTeststep(this.caseInfo.id,e);if(200===t.status){const e=await this.$api.updateInterface(a.id,a);200===e.status&&(0,E.z8)({type:"success",message:"保存成功",duration:1e3}),this.getStepInfo(this.caseInfo.id),this.getAllInter()}},async copyCase(){const e=this.getEditData();e.title=e.title+"_副本";const a=await this.$api.createTeststep(e);201===a.status&&((0,E.z8)({type:"success",message:"复制成功",duration:1e3}),this.getAllInter())},async runCase(){if(!this.envId)return void this.$message({type:"warning",message:"当前未选中执行环境!",duration:1e3});const e=this.getEditData();e.interface={url:this.caseInfo.interface.url,method:this.caseInfo.interface.method};const a={data:e,env:this.envId},t=await this.$api.runCase(a);200===t.status&&(this.runResult=t.data,(0,E.z8)({type:"success",message:"执行完毕",duration:1e3}))},async getStepInfo(e){const a=await this.$api.getTestStepInfo(e);this.runResult=null,200===a.status&&(this.caseInfo={...a.data},this.json=JSON.stringify(this.caseInfo.request.json||{},null,4),this.data=JSON.stringify(this.caseInfo.request.data||{},null,4),this.params=JSON.stringify(this.caseInfo.request.params||{},null,4),this.headers=JSON.stringify(this.caseInfo.headers||{},null,4),this.file=this.caseInfo.file)},getEditData(){let e={...this.caseInfo};try{e.headers=JSON.parse(this.headers)}catch(a){return this.$message({message:"提交的headers数据 json格式错误，请检查！",type:"warning",duration:1e3}),null}if("json"===this.paramType)try{e.request={json:JSON.parse(this.json)},e.request.data=null,e.file=[]}catch(a){return this.$message({message:"提交的application/json数据json格式错误，请检查！",type:"warning",duration:1e3}),null}else if("data"===this.paramType)try{e.request={data:JSON.parse(this.data)},e.request.json=null,e.file=[]}catch(a){return this.$message({message:"提交的x-www-form-urlencoded数据json格式错误，请检查！",type:"warning",duration:1e3}),null}else"formData"===this.paramType&&(e.file=this.file,e.request={});try{return e.request.params=JSON.parse(this.params),e.interface=this.caseInfo.interface.id,e}catch(a){return this.$message({message:"提交的Params数据json格式错误，请检查！",type:"warning",duration:1e3}),null}},getInerfaceData(){let e={...this.caseInfo},a=e.interface;return a},addSetUptCodeMod(e){switch(e){case"ENV":this.caseInfo.setup_script+='\n# 设置全局变量 \ntest.save_global_variable("变量名","变量值")';break;case"env":this.caseInfo.setup_script+='\n# 设置局部变量  \ntest.save_env_variable("变量名","变量值")';break;case"func":this.caseInfo.setup_script+="\n# 调用全局工具函数random_mobile随机生成一个手机号码  \nmobile = global_func.random_mobile()";break;case"sql":this.caseInfo.setup_script+='\n# ----执行sql语句(需要在环境中配置数据库连接信息)----\n# db.连接名.execute_all(sql语句) \nsql = "SELECT count(*) as count FROM futureloan.member"\nres = db.aliyun.execute_all(sql)';break}},addTearDownCodeMod(e){switch(e){case"getBody":this.caseInfo.teardown_script+="\n# Demo:获取响应体(json)  \nbody = response.json()",this.caseInfo.teardown_script+="\n# Demo2:获取响应体(字符串)  \nbody = response.text";break;case"JSextract":this.caseInfo.teardown_script+='\n# Demo:jsonpath提取response中的msg字段  \nmsg = test.json_extract(response.json(),"$..msg")';break;case"REextract":this.caseInfo.teardown_script+='\n# Demo:正则提取响应体中的数据  \nres = test.re_extract(response.text,"正则表达式",)';break;case"ENV":this.caseInfo.teardown_script+='\n# 设置全局变量 \ntest.save_global_variable("变量名","变量值")';break;case"env":this.caseInfo.teardown_script+='\n# 设置局部变量  \ntest.save_env_variable("变量名","变量值")';break;case"func":this.caseInfo.teardown_script+="\n# 调用全局工具函数random_mobile随机生成一个手机号码  \nmobile = global_func.random_mobile()";break;case"sql":this.caseInfo.teardown_script+='\n# ----执行sql语句(需要在环境中配置数据库连接信息)----\n# db.连接名.execute_all(sql语句) \nsql = "SELECT count(*) as count FROM futureloan.member"\nres = db.aliyun.execute_all(sql)';break;case"http":this.caseInfo.teardown_script+='\n# 断言http状态码 \n# Demo:断言http状态码是否为200  \ntest.assertion("相等",200,response.status_code)';break;case"eq":this.caseInfo.teardown_script+='\n# 断言相等 \ntest.assertion("相等","预期结果","实际结果")';break;case"contain":this.caseInfo.teardown_script+='\n# 断言包含:预期结果中的内容在实际结果中是否存在 \ntest.assertion("包含","预期结果","实际结果")';break}}},watch:{step(e){e&&this.getStepInfo(e)}},created(){this.step&&this.getStepInfo(this.step)}},M=t(40089);const O=(0,M.Z)(z,[["render",D],["__scopeId","data-v-a4fce516"]]);var $=O}}]);
//# sourceMappingURL=441.6aa34d5e.js.map